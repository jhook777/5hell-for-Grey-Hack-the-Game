if DEBUG then print("<size=75%>loading help.5pk v 4.3.0...(125.182)")

command.help = function(arg1, arg2, arg3=0, arg4=0)
	if arg1 == "help" or arg1 == "-h" then return "helping..."
	if arg1 == "shell" then return (colorRed+instance.name+CT+" v "+ver+" by Plu70"+char(10)+"(type<b> shell </b> for more info.)")
	if arg1 == "guide" then
		print(colorGold+"<u>= = = = = = = = = = = = = =</u>"+CT)
		print "<u>""Quick"" start guide/tutorial:"+char(10)+
		"The 5hell command prompt is the "+colorWhite+"|>"+CT+" symbol."+char(10)+
		"You launch commands from here and return here when they are"+char(10)+
		"complete. You may pipe the output of one to the input of another,"+char(10)+
		"or chain commands without piping, with "+colorLightBlue+"|"+CT+" and "+colorLightBlue+"||"+CT+" respectively."+char(10)+char(10)+
		"5hell features a system called """+colorLightBlue+"glasspool"+CT+""" that mirrors shell objects."+char(10)+
		"This means that, wihle active, most of your commands will execute"+char(10)+
		"on the target shell instead of locally.Be aware that some commands "+char(10)+
		"are local only, meaning they run on the machine running the script, not the active shell."+char(10)+
		"The prompt will turn blue, like so: "+colorLightBlue+"|>"+CT+" when "+colorLightBlue+"glasspool"+CT+"is active."+char(10)+char(10)+
		colorWhite+"Setup:"+char(10)+
		"First, and foremost, set up your email and bank and get a hackshop ip"+char(10)+
		"and download metaxploit.so from it. Then launch 5hell and type:"+char(10)+
		"<b>kore -r</b> and follow the prompts. Optionally generate the rainbow tables."+char(10)+char(10)+
		colorWhite+"<u>Hack your first target (optimized for 10-key pad):"+char(10)

		print colorGold+"probe [ip]"+CT+" -- to perform a whois and portscan on a target ip "+char(10)+
		colorGold+"-- it sets the target IP in 5phinx (sphinx) as well"+char(10)+
		colorGold+"sphinx"+CT+" -- bring up the pentest tool; 5phinx"+char(10)+
		"-- "+colorGold+"press [0]"+CT+" to view the portmap again, if you wish"+char(10)+
		"-- "+colorGold+"press [4]"+CT+" to change the target ip, if needed"+char(10)+
		"-- "+colorGold+"press [5]"+CT+" to change the target port, if needed"+char(10)+
		"-- "+colorGold+"press [=] or [+]"+CT+" to connect a local or remote metaLib"+char(10)+
		"-- "+colorGold+"press [3]"+CT+" to database the target lib, if unknown "+char(10)+
		"---- ignore [1] and [2], for now"+char(10)+
		"---- any results obtained by the databasing are stored in the "+colorOrange+"BUFFER"+char(10)+
		"-- "+colorGold+"press [left_arrow]"+CT+" (or [7]) to access <b>malp</b> and then "+colorOrange+"[5]"+CT+"for the "+colorOrange+"BUFFER"+char(10)+
		"---- use the left arrow key (or [7]) again when you want to return to the main menu"+char(10)+
		"-- assuming* you obtained a shell object from the databasing, "+colorGold+"select a shell object by index"+char(10)+
		"----* you may need to rerun an attack after fulfilling some requirements"+char(10)+
		"----* use the left arrow key (or [7]) to return to the main menu, then:"+char(10)+
		"----* "+colorGold+"press [a]"+CT+" to select and fire a single attack from a menu"+char(10)+
		"----* return to the buffered shell in malp"+char(10)+
		"-- "+colorGold+"press [3]"+CT+" to upload your <b>rkit</b> to the target and automatically launch 5hell"+char(10)+
		"-- "+colorGold+"type brutus | gp "+CT+"to do two things:"+char(10)+
		"---- get a root shell on the target "+char(10)+
		"---- pipe that root shell to "+colorLightBlue+"glasspool"+CT+" for shell mirroring"+char(10)+
		"-- "+colorGold+"type /home/guest/rkit/5hell"+CT+" to launch 5hell as root"+char(10)+
		"*** "+char(10)+
		"Congratulations! You've successfully gotten root on your first target!"+char(10)

		print "Use "+colorGold+"felix"+CT+" -- as a file explorer and BUFFER files/folders"
		print "Explore the other commands, many are utility. Some are quite advanced."
		print "You may hack from the command line, instead of 5phinx, for more precision."
		print colorGold+"*--*"
		print "By default, <b>/root/rkit</b> is the location of the rootkit and should consist of:"+char(10)+
		"    <b>5hell, crypto.so, metaxploit.so, database.csv"+char(10)+
		"Additionally it may contain:"+char(10)+
		"-- <b>dig.bat, 5hell.d, tables/, ScanLan.exe"+char(10)+
		"-- and other <b>any</b> scripts/tools/libs/files you find useful"
		print colorGold+"*--*"
		print "In most cases you may type<b> kore -r</b> to have the rkit built for you"+char(10)+
		"-- kore will look for 5hell in /bin, and meta and crypto in /lib"+char(10)+
		"-- add these files manually if kore is unable to do so"+char(10)+char(10)
		print colorGold+"When you are finished with your hacking:"+char(10)+
		colorWhite+"--"+colorGold+"type sc -d</color> to delete your rkit and corrupt the system.log"+char(10)+
		colorWhite+"---- this will cover your tracks"+char(10)+
		colorGold+"-- you may then safely type <b>exit y<b> to return from your root session"+char(10)+
		colorWhite+"---- this will drop you back to the glasspool prompt;"+char(10)+
		colorWhite+"---- be paranoid and: <b>sc</b> one last time"+char(10)+
		colorGold+"Finally, type exit y"+colorWhite+" to return to your original session with your head held high"
		"<b>Additional light reading:"
		print "For scripting see:<b> do -h</b>"+char(10)+
		"For dictionary attacks see:<b> cerebrum -h, brutus -h, gopher -h, hashim -h</b>"
		print "For networking see:<b> air -h, iwlist -h, ifconfig -h, ssh -h, kraken -h</b>"
		print"For security see:<b> perms -h, usr -h, grp -h, sniff -h, silentclean -h, bios -h"
		print"For dev tools see:<b> scribus -h, makfit -h, clipb -h, make -h, chop -h, dfit -h </b>"
		print colorGold+"*--*"
		return 0
	end if

	help_conventions = "<b>CONVENTIONS</b>"+char(10)+"While a great deal of 5hell is discordant, there are some conventions:"+char(10)+char(10)+
	"You may toggle the full prompt and minimal promt by typing: "+char(10)+
	"<b>prompt</b> at the command line"+char(10)+
	"- - - - - - - - - - "+char(10)+
	colorWhite+"Input: arguments and quote blocks and piping oh my!"+char(10)+
	"-- 5hell uses a 4 argument system. This means all commands take at most 4 arguments"+char(10)+
	"-- this might sound limiting but it isn't at all in practice. Each of the 4 arguments may be overloaded."+char(10)+
	"Some input methods are:"+char(10)+
	colorLightBlue+"----* simply typing input: |> ping 1.1.1.1"+char(10)+
	"------ up to four typed arguments"+char(10)+
	"------ remember that |> is the prompt, you don't type that part"+char(10)+
	colorLightBlue+"----* using single quotes to wrap text: |> echo "" this is a text block "" "+char(10)+
	"------ would return: this is a text block"+char(10)+
	"------ note that: |> echo ""this is a text block"" "+char(10)+
	"------ would return: """"this is a text "+char(10)+
	"------ this allows you to overload each argument with more than one ""word"""+char(10)+
	"------ easy clip and piping and objects(mostly) are preserved inside of text blocks"+char(10)+
	"------ <b>you may escape a floating quote with <b>\"""+char(10)+
	"--------eg: macro set foo "" echo \"" bar none \"" """+char(10)+
	colorLightBlue+"----* use <color=yellow>do</b></color> to run a batch of commands from a file or from memory using an editor"+char(10)+
	"------ |> do -- without arguments do will prompt for number of iterations then open the editor"+char(10)+
	"------ |> do 1 -- would bring up an editor commands typed here will be executed in order"+char(10)+
	"------ |> do 1 ping 1.1.1.1 -- would result in pinging 1.1.1.1 once"+char(10)+
	"------ |> do 5 "" rnip 1 | dig "" -- would run dig on a random ip 5 times"+char(10)+
	"------ |> do 1 -f /foo.bar -- execute the batch of commands in the file foo.bar"+char(10)+
	"-------- you may launch 5hell from the game's command line with <b>do</b> parameters"+char(10)+
	"-------- the format is the same as if typing commands on the command line"+char(10)+
	"-------- newlines in the script are considered to be new command line entries"+char(10)+
	"-------- you may use piping, easy clip, and even calls for <b>do</b> to execute further scripts"+char(10)+
	"-------- you may use text blocks for complex commands in place of files or the editor"+char(10)+
	"--eg:  |> do 3 "" rnip 1 | dig |  | cob get metx | meta -i | db -m | zap "" | poke test.txt "" this is a bunch of text going into a file """+char(10)+
	colorGold+"** it is possible to almost completely automate every aspect of 5hell via <u>do</u> and <u>dig</u>"+char(10)+
	"------ for ease of use <b><color=white>do 1 -f</b></color> has been aliased to <color=white><b>bat</b></color> in 5hell.src:"+char(10)+
	"-------- |> <b>bat /foo.bar</b> is equivalent to |> <b>do 1 -f foo.bar</b>"+char(10)+
	"------ please see <u><b><color=yellow>do -h</b> and <b>dig -h</b></u></color> for more information on automation"+char(10)+
	colorLightBlue+"----* piping input: |> grep -f ^syst | file -p | cp /etc/passwd"+char(10)+
	"------ would result in copying /etc/passwd over top of system.log (if permissions allowed it)"+char(10)+
	"------ piping allows you to transfer the output of one command to the innput another command"+char(10)+
	"------ in the above example the output of grep [args...] is the input of file -p [input]"+char(10)+
	"------ and the output of file -p [args] is the input of cp /etc/passwd [input]"+char(10)+
	"------ please see <b>pipe -h</b> for more"+char(10)+
	"------ if malp is the backbone of 5hell, pipes are the circulatory system of 5hell"+char(10)+char(10)+
	colorWhite+"Prompts: "+CT+"|> , :> , ||: "+char(10)+
	"<color=#FFFFFF>|>  --  this is the standard Command Line Interface prompt"+char(10)+
	"-- by default there will be information printed before this"+char(10)+
	"-- toggle to a minimalist prompt with: <b>prompt</b>"+char(10)+
	"-- fires CLI commands"+char(10)+
	colorLightBlue+"|> "+CT+"  --  by default, the GLASSPOOL prompt turns the "+colorLightBlue+"|>"+CT+" blue"+char(10)+
	"-- this means commands execute on the remote object controlled by glasspool"+char(10)+
	"-- see glasspool -h for more"+char(10)+
	colorWhite+":>  "+CT+" --  this is a liminal prompt, it expects a string or empty return"+char(10)+
	"-- this is used to gather user input within a command"+char(10)+
	colorWhite+"||: "+CT+" --  this is an 'any key' prompt"+char(10)+
	"-- it takes a single keypress"+char(10)+
	"-- this is used in 'button' driven menus"+char(10)+char(10)+
	colorWhite+"Decision Prompts: "+CT+"[ N/Y/X ] [n/y/x]"+char(10)+
	"-- Multiple choice prompts have a default"+char(10)+
	"-- the default is always Capitalized and sometimes highlighted"+char(10)+
	"-- the default is chosen if <b><enter></b> is pressed without input"+char(10)+
	"-- unless otherwise noted, default is chosen if input doesn't match a choice"+char(10)+
	"E.G: |> psudo"+char(10)+
	"Open shell? [c/y/N]"+char(10)+
	"||:"+char(10)+
	"-- in this example, the choices are [c], [y], and [N]"+char(10)+
	"---- [c] -- enter credentials"+char(10)+
	"---- [y] -- open shell"+char(10)+
	"---- [n] or anything else -- no; return/abort"+char(10)+
	"------ this is because N is the default"+char(10)+char(10)+
	colorWhite+"Prompt: advanced:"+char(10)+
	"-- by default the prompt will display the public and local ip of the active shell"+char(10)+
	"---- or computer if using glasspool on a computer object"+char(10)+
	"-- by default the prompt will display computer name and working directory"+char(10)+
	"-- by default the prompt indicates user privileges (root,user,guest) with:"+char(10)+
	"---- under the ip information there will be a:"+char(10)+
	"------ a<color=red> red line for root</color>, <color=green>green line for user </color>, </color>and <color=white>white line for guest"+char(10)+
	"---- please note that user permissions are determined by access level"+char(10)+
	"---- in some cases, this might not be the actual user"+char(10)+
	"-- you may customize the prompt to your liking in 5hell.src"+char(10)

	help_tools = "<u><b>Main tools:"+char(10)+
	colorCyan+"probe "+colorWhite+"-- whois and portmap a target"+char(10)+
	colorCyan+"db "+colorWhite+"-- scan target and <b>database results</b>"+char(10)+
	colorCyan+"meta "+colorWhite+"-- metaLib and metaxploitLib fine control"+char(10)+
	colorCyan+"zap "+colorWhite+"-- select and fire exploits one at a time (does not database)"+char(10)+
	colorCyan+"roil "+colorWhite+"-- fire all exploits at once (does not database)"+char(10)+
	colorCyan+"malp "+colorWhite+"-- Memory Alpha: BUFFER management"+char(10)+
	"-- exploit results and other objects go here"+char(10)+
	"-- this is arguably the backbone of 5hell"+char(10)+
	colorCyan+"scpm "+colorWhite+"-- menu and/or cli driven scp"+char(10)+
	colorCyan+"kraken "+colorWhite+"-- proxy management"+char(10)+
	colorCyan+"scribus "+colorWhite+"-- simple text editor"+char(10)+
	colorCyan+"cerebrum "+colorWhite+"-- add 325k+ passwords to custom_object.dictionary"+char(10)+
	colorCyan+"brutus "+colorWhite+"-- use custom_object.dictionary to get root on any (unmodified) npc machine"+char(10)+
	colorCyan+"See: [command] [-h|help] for more help on these and other commands"+char(10)

	help_buffer = colorOrange+"The BUFFER"+char(10)+
	colorOrange+"</b>The BUFFER stores objects. Anything may be stored in the BUFFER."+char(10)+
	colorOrange+"You access the BUFFER with the <b>malp</b> command >> option [5]"+char(10)+
	colorOrange+"</b>When an exploit is run, the result is stored in the BUFFER. You"+char(10)+
	colorOrange+"</b>may interact with these objects in a number of ways by selecting them"+char(10)+
	colorOrange+"</b>from the list and using their context menu (if the object has one)."+char(10)+
	colorOrange+"</b>One way to fetch an object from the BUFFER for use elswhere is to use the clipboard:"+char(10)+
	colorOrange+"</b>|> "+colorGreen+"clipb @B [index|-m]</color>"+colorOrange+"</b>-- where index == BUFFER[index]"+char(10)+
	colorOrange+"</b>-- then pipe the value to another function"+char(10)+
	colorOrange+"</b>Easy Clip! As of version 3.9.6 any command may take <b>@B [index|-m] as one or more parameters!"+char(10)+
	colorOrange+"</b>-- if -m is passed instead of an index, a menu is displayed"+char(10)+
	colorOrange+"</b>|> roil | scpm /root/rkit @B -m"+char(10)+
	colorOrange+"You may pipe anything into the buffer with |><b> [command_returning_input] | malp</b>"+char(10)+char(10)+
	colorGreen+"Easy Clip! You may reference the clipboards with the @ symbol:"+char(10)+
	colorGreen+"***  clipa, clipb, and clipc are all clipboard spaces  ***"+char(10)+
	colorGreen+"</b>You may use @a, @b, and @c to reference their values"+char(10)+
	colorGreen+"</b>e.g. echo hello world | clipa |  | poke hello.txt @a"+char(10)+
	colorGreen+"*** tbuf, home, do ***"+char(10)+
	colorGreen+"</b>e.g. <b>gopher @tbuf</b>, e.g. <b>rshell @home</b>, e.g <b>scribus @do"+char(10)+char(10)+
	colorCyan+"</b>The CUSTOM_OBJECT is a way for scripts to share information between"+char(10)+
	colorCyan+"</b>nested launches. This means you can launch 5hell with 5hell and pass objects back and forth."+char(10)+
	colorCyan+"</b>You interact with the custom_object via the various <b>cob</b> commands"+char(10)+
	colorCyan+"</b>Namely: cob get and cob set."+char(10)+
	colorCyan+"For ease of use: <color=white>cob get</color> and <color=white>cob set</color> have been aliased to:"+char(10)+
	colorCyan+"</b>-- <color=white>get</color> and <color=white>set</color> in 5hell.src"+char(10)+
	colorCyan+"</b>-- |> <b>cob set bob burger </b>is equivalent to |><b> set bob burger"+char(10)+
	colorCyan+"</b>-- |> <b>cob get bob</b> is quivalent to |><b> get bob"+char(10)+
	colorCyan+"</b>An example would be "+colorGold+"cerebrum</color> which loads the dictionary to the custom object."+char(10)+
	colorCyan+"</b>-- When generated, the dictionary is loaded to the custom object under the key: <b>dictionary</b>."
	colorCyan+"</b>-- Once loaded, you may <b>run</b> 5hell through nested launches and the dictionary will persist."+char(10)+
	colorCyan+"</b>-- This also allows you to import/export metaLib's and metaxploitLib's between machines!"+char(10)
	colorCyan+"</b>-- Easy Clip! You may reference a value in the custom object by it's key with: <b>@o [key]</b>"+char(10)+
	colorGold+"</b>--eg:<b> set foo "" look out for that tree, "" | echo @o foo george </b>// look out for that tree, george"+char(10)+
	colorCyan+"</b>-- Please see cob -h for more informaiton"

	help_logs = colorWhite+"The dreaded "+colorRed+"System.log"+char(10)+
	"Actions that generate an entry in system.log: "+char(10)+
	"-- establishing a net_session on a server (not a router)"+char(10)+
	"-- connecting via Browser.exe to a server"+char(10)+
	colorWhite+"---- connection established on port ##"+char(10)+
	"-- obtaining a shell (server/router)"+char(10)+
	colorWhite+"---- shell obtained on port ##"+char(10)+
	"-- deleting a file"+char(10)+
	colorWhite+"---- file deleted [ip]"+char(10)+
	"-- routing a connection with:"+char(10)+
	"-- connect_service or file_explorer"+char(10)+
	colorWhite+"---- connection routed [ip]"+char(10)+
	"-- shell disconnect"+char(10)+
	"-- i.e. exiting from start_terminal"+char(10)+
	colorWhite+"---- connection closed [ip]"+char(10)+char(10)+
	colorRed+"Active Traces"+CT+" will start when <b>shell.start_terminal</b> is used"+char(10)+
	"on an npc machine with an active admin of sufficient knowledge and give-a-damn."+char(10)+
	"Generally, if there is a root: dsession active, using start_terminal will trigger"+char(10)+
	"an active trace. Active traces are stopped by disconnecting (exiting) that terminal instance."+char(10)+char(10)+
	"When using 5hell you should NOT ever open a terminal (on a target) unless you are doing an Academic or"+char(10)+
	"Police record mission. OR if you absolutely need to open the browser to edit firewall or port rules"+char(10)+
	"on a target. Otherwise, use <b>glasspool</b> and <b>run</b> to leverage shell object manipulation instead."+char(10)+char(10)+
	"However! You <u>should</u> start_terminal on your end point attack proxy. In fact, do it twice:"+char(10)+
	"-- use <b>prox</b> to tunnel to your end point proxy then launch 5hell and type <b>psudo</b> and then select [y]"+char(10)+
	"-- this will start_terminal on top of your start_terminal, effectively looping your connection on that machine"+char(10)+
	"-- this will ensure your end point proxy's ip is left in logs, not your origin ip"+char(10)+
	"-- without this, you risk exposing ip's behind the proxy"+char(10)+
	"-- note: this means you'll have to 'exit' twice from that proxy to return home"+char(10)+
	colorRed+"Passive Traces"+CT+" can/will start when certain actions have been left unaddressed:"+char(10)+
	"- Deleting a file and not removing the log entry"+char(10)+
	"- Leaving a connection closed log without a corresponding connection established log"+char(10)+
	"- Leaving a shell connected log at all"+char(10)+
	"- I think connection routed logs trigger traces, too. Not sure though."+char(10)+char(10)+
	colorMagenta+"We all leave logs, sometimes. To clean them up, here are a few methods:"+char(10)+
	colorLightBlue+"Silentclean "+CT+"-- local log corruption using a text file"+char(10)+
	"-- creates a file used to corrupt logs"+char(10)+
	"-- has nuke option (see: silentclean -h)"+char(10)+
	colorCyan+"Rclean "+CT+"-- remote (or local) log corruption using objects"+char(10)+
	"-- uses a file already on system to corrupt logs"+char(10)+
	"-- accepts and works on piped objects (see: rclean -h)"+char(10)+
	colorGold+"MV "+char(10)+"-- yep, just the <b>mv</b> command"+char(10)+
	"-- poke haha | mv haha /var/system.log"+char(10)+
	colorOrange+"Wiping the log with one of these methods using a reverse shell is best"+char(10)+
	"but not necessary. You may run silentclean, exit 5hell, exit the terminal, and you will not leave a disconnect log."+char(10)+
	"-- be aware that taking any log-creating action after running sc, except exiting, may regenerate the log."+char(10)

	help_alias = "<u><b>aliases || do script || shortcuts || macros || User Defined Behavior"+char(10)+
	"5hell can be very simple to use, or very, very complicated, depending on your goals."+char(10)+
	"It isn't necessary to learn 100% of 5hell. Nor is it necessary to suffer through some of it's"+char(10)+
	"more complex chains of commands. You can define your own behavior in a number of ways:"+char(10)+char(10)+
	colorLightBlue+"Aliases: "+char(10)+
	colorWhite+" You may define aliases in the aliases section of 5hell.src"+char(10)+
	colorWhite+"the default ones supplied are all prompt replacements. There are also 'easy clip' defenitions"+char(10)+
	colorWhite+"that replace arguments in the user input with, for instance, the contents of a clipboard or"+char(10)+
	colorWhite+"your @home server ip. These hard coded aliases may be more complicated than a simple"+char(10)+
	colorWhite+"word or string replacement. You may, for instance, have a simple two word alias fire"+char(10)+
	colorWhite+"a whole series of commands. This might be considered a macro at that point, but also"+char(10)+
	colorWhite+"might not quite qualify."+char(10)+char(10)+
	"Here is a list of the currently defined default aliases in 5hell.src:"+char(10)+
	colorLightBlue+"Alias           | Definition"+char(10)+
	colorCyan+"bat [path]      |</b> do 1 -f [path]"+char(10)+
	colorCyan+"set [key] [val] |</b> cob set [key] [val]"+char(10)+
	colorCyan+"get [key]       |</b> cob get [key]"+char(10)+
	colorCyan+"lock            |</b> perms lock all"+char(10)+
	colorCyan+"exit            |</b> quit"+char(10)+
	colorCyan+"sc [opt]        |</b> silentclean [opt]"+char(10)+
	colorCyan+"gp [#]          |</b> glasspool [#]"+char(10)+
	colorCyan+"prompt          |</b> -this will toggle the full_prompt on/off-"+char(10)+char(10)+
	colorWhite+"Easy Clip       |</b> Replacement"+char(10)+
	colorGold+"@a              |</b> clipa -- globals.CLIP[""a""]"+char(10)+
	colorGold+"@b              |</b> clipb -- globals.CLIP[""b""]"+char(10)+
	colorGold+"@c              |</b> clipc -- globals.CLIP[""C""]"+char(10)+
	colorGold+"@tbuf           |</b> transmission buffer -- globals.T_BUF"+char(10)+
	"-- this is                |</b> where hashes go when the tree command finds them"+char(10)+
	colorGold+"@t              |</b> targetIP"+char(10)+
	colorGold+"@p              |</b> targetPort"+char(10)+             
	colorGold+"@home           |</b> get_custom_object.HOME server ip address defined in 5hell.src"+char(10)+
	"-- this is                |</b> usually an attack proxy running ssh and rshell servers"+char(10)+
	"-- please don't           |</b> use your actual home pc for this"+char(10)+
	colorGold+"@B [index|-m]   |</b> directly reference a value in the"+colorOrange+" BUFFER "+CT+"by [index] or menu: [-m]"+char(10)+
	colorGold+"@o [key]        |</b> directly reference a value in the custom object by key"+char(10)+
	colorGold+"@r [index]      |</b> directly reference a shell in the rsi buffer by [index] or menu: [-m]"+char(10)+
	colorWhite+"All <b>@</b> aliases (known as ez_clips) may be escaped with the <b>\</b> character:"+char(10)+
	"<size=75%>--eg: <b>\@a</b>, \@home"+char(10)+
	"<size=75%>--eg: <b>clipa bob || echo @a -- will echo 'bob', while "+char(10)+
	"<size=75%>--eg: <b>clipa bob || echo \@a -- will echo '@a' "+char(10)+char(10)+
	"Please note: several commands have their own references for editing the clipboards"+char(10)+
	"-- these commands will use @clipa, @clipb, @clipc instead of @a, @b, @c"+char(10)+
	"Further, the clipa, clipb, and clipc will use @B to reference the BUFFER:"+char(10)+
	"-- e.g: |> <b>clipa @B 1</b> -- copy the object at index 1 in the BUFFER to clipa"+char(10)+
	"---- that object may then be used by other commands that accept piped objects as input"+char(10)+
	"-- as of 3.9.6 any command may use @B [index] as any parameter(s)"+char(10)+
	"-- there are other ways to pipe objects around besides the clipboards, explore to learn more."+char(10)+
	char(10)+
	colorOlive+"Marcos and Automation: "+char(10)+
	colorWhite+"<size=75%></b>You may define custom macro's with the "+colorOrange+"</b>macro</color> command. A macro is a "+char(10)+
	colorWhite+"<size=75%></b>runtime-defined set of instructions executed by a single command. Think of it as an alias that performs"+char(10)+
	colorWhite+"<size=75%></b>commands for you. Additionally, you may execute batch commands either from a file or from memory. There are"+char(10)+
	colorWhite+"<size=75%></b>a few differences between a <u>macro</u> and a <u>do script</u>."+char(10)+
	colorWhite+"<size=75%></b>Please see:  "+colorLightBlue+"</b>do -h, macro -h, and help automation for more information on this topic."+char(10)

	help_automation = "<u><b>automation || macro || do script || batch file"+char(10)+
	colorCyan+"How to fully automate <color=red>5</color><color=white>hell</color>:"+char(10)+
	colorWhite+"</b> As mentioned in <b>help alias</b>, you may define custom macro's, or sets of commands"+char(10)+
	colorWhite+"</b>that <color=red>5hell</color> will execute automatically. The two commands involved are:"+char(10)+
	colorOrange+"--: </b>macro</color> and "+colorOrange+"</b>do"+char(10)+
	colorWhite+"</b>The two commands function similarly in that they execute the defined commands as "+char(10)+
	colorWhite+"</b>if they were typed by you. The list of commands, or 'script,' is formed the same "+char(10)+
	colorWhite+"</b>way for both commands. Therefore both commands may execute the same scripts. That is, "+char(10)+
	colorWhite+"</b>do may execute a macro, and macro may execute a do script. This way, don't have to "+char(10)+
	colorWhite+"</b>remember two different formats for these similar commands."+char(10)+
	colorWhite+"</b>The specific behavior of each is as follows:"+char(10)+
	colorOrange+"DO: "+char(10)+
	colorCyan+" Do is essentially a 'do while' loop that executes at least once. You specify the number "+char(10)+
	colorCyan+"</b>of loops with the first argument: <b>do [some integer]</b> "+char(10)+
	colorCyan+"</b>The <b>primary</b> way to use do is like a macro that you want repeated on a loop."+char(10)+
	colorCyan+"</b>If there are no more arguments after the number, an editor will open (scribus) where you may"+char(10)+
	colorCyan+"</b>type out the commands you want executed line by line. Lines may be complex lines, that is, "+char(10)+
	colorCyan+"</b>the lines may include piping. The output of a line will <b>not</b> be passed to the following "+char(10)+
	colorCyan+"</b>line. This way, you may type out commands without using the <b>|  |</b> trick. Once "+char(10)+
	colorCyan+"</b>you type <b>@</b> on a new line, the script will begin executing. Use <b>@@</b> on a new line"+char(10)+
	colorCyan+"</b>to abort execution. Additionally, you may use<b> scribus @do</b> to edit the buffer without executing."+char(10)+
	colorCyan+"</b>You may then fire it later with<b> do [#]</b> and then <b>@</b>."+char(10)+
	colorLightBlue+"An example do script, either written in the editor or read from a file* (*explained in the third usage): "+char(10)+
	colorGold+"</b>ifconfig -p | probe"+char(10)+
	colorGold+"</b>brutus | clipb"+char(10)+
	colorGold+"</b>grep -p 5hell | clipc"+char(10)+
	colorGold+"</b>run @c "" do 1 rshell @home "" @b"+char(10)+
	colorGold+"</b>rclean @b"+char(10)+
	colorLightBlue+"</b>This would result in a network probe, an escalation, a root rshell placement, and "+char(10)+
	colorLightBlue+"</b>finally a log scrub. This is useful to run each time you attack a new target and "+char(10)+
	colorCyan+"</b>is also included as the default <b>dig.bat"+char(10)+
	char(10)+
	colorCyan+"</b>The <b>Second</b> way to use do is to define the commands on a single line, wrapped by floating quotes. "+char(10)+
	colorLightBlue+"</b>This would look like:<b> do 5 "" rnip 1 | ping 1.1.1.1 """+char(10)+
	colorLightBlue+"</b>This results in pinging 1.1.1.1 five times. More complex commands may be further chained by piping. "+char(10)+
	colorLightBlue+"</b>Be sure to wrap the commands you wish to <b>do</b> in quotes* that do not touch anything "+char(10)+
	colorLightBlue+"</b>(ie, floating) as shown above."+char(10)+
	colorLightBlue+"<b>* If the command string is only two words, quotes are not needed. eg: do 1 ping 1.1.1.1"+char(10)+
	char(10)+
	colorCyan+"The <b>Third</b> way to use do is to read defined commands from a file."+char(10)+
	colorLightBlue+"</b>The commands in the (text) file are written exactly as they are when using the editor to list commands."+char(10)+
	colorLightBlue+"</b>These commands are executed with:<b> do [#] -f [pathToFile]"+char(10)+
	colorLightBlue+"</b>For your convenience, the alias "+colorGold+"</b>bat [path]</color> will be relaced by <b>do 1 -f [path]"+char(10)+
	colorLightBlue+"</b>This is most useful when launching 5hell with a set of instructions. If you launch 5hell from the command "+char(10)+
	colorLightBlue+"</b>line with: <b>5hell do 1 -f [path] </b>5hell will automatically execute the commands in the file and then exit."+char(10)+
	colorLightBlue+"</b>If you do not wish 5hell to exit after completion, use a file named <b>do.rc</b> in your home_dir/Config or"+char(10)+
	colorLightBlue+"</b>in rkit (executes only if ~/Config/do.rc does not exist). Note that <b>do</b> does not return a value other than"+char(10)+
	colorLightBlue+"</b>it's completion time. Macros, however, do return the final value. Additionally, the <b>dig</b> command makes"+char(10)+
	colorLightBlue+"</b>use of the <b>do</b> engine when executing <b>dig.bat</b> (which itself, may reference other do scripts). "+char(10)+
	colorLightBlue+"</b>This allows 5hell to be fully automated throughout an arbitrary number of attacks. Cool stuff, right!?"+char(10)+
	char(10)+
	colorGold+"Macro:"+char(10)+
	colorWhite+"</b>A macro is similar to a do script, except it is intended to be written 'on the fly.' In other words, you type "+char(10)+
	colorWhite+"</b>the macro definition on the command line, without the editor, in most cases. If you do wish to use the editor, "+char(10)+
	colorWhite+"</b>simply use: <b>scribus @clipa/b/c | macro set [macro_name]"+char(10)+
	colorWhite+"</b>Marco's are stored in the custom object and are executed when called by name: <b>macro [name]"+char(10)+
	colorWhite+"</b>A macro <b>will</b> return it's final value and will not print execution time. There is no built in option "+char(10)+
	colorWhite+"</b>to read a macro from a file, however <b>cat [file] | macro set [name]</b> may be used to achieve this."+char(10)+
	colorWhite+"</b>An example macro definition:"+char(10)+
	colorWhite+"macro set prop "" cp 5hell /bin | cp /bin/5hell rkit | kraken /bin/5hell | kraken rkit/5hell """+char(10)+
	colorWhite+"</b>Again, it looks exactly the same as an inline do script, because it is! However, this script is stored "+char(10)+
	colorWhite+"</b>in the custom object, meaning it's string may be retrieved with <b>get macro.[name]</b> and piped somewhere,"+char(10)+
	colorWhite+"</b>such as to a file. You may absolutely fire a macro with <b>do</b>. Simply type: <b>do [#] @o [macroName]</b>"+char(10)+
	colorWhite+"</b>and do will happily execute the macro. Likewise, as mentioned earlier, piping the </b>contents of a "+char(10)+
	colorWhite+"</b>do script to macro will define the macro as that do script."+char(10)+
	char(10)+
	"This all may seem complicated, but it is actually rather simple: "+char(10)+
	"--define a list of commands as if you were typing them, fire the batch of commands."+char(10)+
	"For more information, please see: <b>do -h, macro -h, dig -h</b>, help alias, and help conventions."+char(10)+
	"Also, visit the 5hell discord for example scripts!"

	help_daemon = colorWhite+colorRed+"</b>5</color>hell has a handful daemon commands: htop, hashim, outmon, and rsi."+char(10)+
	colorWhite+"Three of these commands; htop, hashim, and outmon, are controlled by a 'daemon controller.' "+char(10)+
	colorWhite+"This controller functions by creating a file named<b> 5hell.d</b> in your root directory and writes a"+char(10)+
	colorWhite+"line to that file that matches a daemon process that is running. When this line is removed from the file, or"+char(10)+
	colorWhite+"or the file itself is deleted, the daemon process will end. This allows you to start and stop daemons in 5hell"+char(10)+
	colorWhite+"without having to kill the whole script with ctrl+c. Note that rsi is not controlled by the daemon manager as it"+char(10)+
	colorWhite+"exits daemon mode when a reverse shell connects to it."+char(10)+
	"See also: htop -h, hashim -h, outmon -h, rsi -h"

	if arg1 == "-s" or arg1 == "show" or arg1 == "search" then
		c_buf = []
		h_buf = []
		for cmd in command.indexes.sort
			if cmd == "shell" or cmd == "help" or cmd == "__isa" or cmd == "classID" then continue
			h = @command[cmd]
			c_buf.push(colorWhite+cmd+CT)
			c_buf.push(h("help"))
		end for
		c_buf.push(colorWhite+"shell"+char(10)+"Usage: shell -- outputs instance_name, num_commands and dictionary_size.")
		c_buf = c_buf+[help_buffer,help_conventions,help_logs,help_tools,help_alias]

		if arg2 then
			invoke_regex = false
			special_chars = ["*","^","$","#"]
			for special in special_chars
				if arg2.indexOf(special) >= 0 then invoke_regex = true
			end for
			for c in c_buf
				found = false
				if not invoke_regex then 
					if c.indexOf(arg2) >= 0 then 
						found = true
					end if
				else
					for w in c.split(" ")
						if globals.re.match(arg2.values, w.values) then 
							c = c.replace(w,colorRed+w+CT)
							found = true
						end if
					end for
				end if
				if found then h_buf.push( c.replace(arg2, colorRed+arg2+CT) +char(10)+ colorGold+"<u>---</u>"+ CT +char(10) )
				if DEBUG then print(h_buf[-1])
			end for
			return colorGold+"<u>= = = = = = Help Search = = = = = =</u>"+char(10)+colorLightBlue+"Found: </b>"+h_buf.len+"<b> results."+CT+char(10)+h_buf.join(char(10))
		end if
		return c_buf.join(char(10))
	end if
	if arg1 == "home" then
		return "  Convention: <b>@home</b> -- indicates a server you, the end user, have set up for 5hell"+char(10)+
		"services. Servers should be of type <b>SSH</b> and/or <b>RSHELL</b> and it is recommended to run:"+char(10)+
		"<b> pwgen | pwgen hash</b>"+char(10)+
		"on ssh servers running the <b>hashim daemon</b>. The @home server is used by:"+char(10)+
		"<b> cerebrum, brutus, linkdb, transmit, and rshell/rsi</b>"+char(10)+
		"For example: <b>rshell @home notAvirus</b> would create an rshell with ip set as your @home server."+char(10)+
		"That server would be running the rshell_server used by the rsi command. An @home server may also run:"+char(10)+
		"<b> hashim, outmon, or other custom services</b>. Please contact Plu70 if you have questions about setting"+char(10)+
		"up these resources."+char(10)+
		"Please edit the appropriate line in 5hell.src to setup @home by providing an ip address, port, password,"+char(10)+
		"and directory for the pass file. It is important that you secure 5hell with login authentication,"+char(10)+
		"either stock or your own, to prevent exposure of this information! "
	end if
	
	if arg1 == "-A" or arg1 == "alias" then return help_alias
	if arg1 == "-c" or arg1 == "conventions" or arg1 == "-p" or arg1 == "prompt" then return help_conventions
	if arg1 == "-t" or arg1 == "tools" then return help_tools
	if arg1 == "-b" or arg1 == "buffer" then return help_buffer
	if arg1 == "-l" or arg1 == "logs" then return help_logs
	if arg1 == "-a" or arg1 == "automation" then return help_automation
	if arg1 == "-d" or arg1 == "daemons" or arg1 == "daemon" then return help_daemon

	index = command.indexes
	if index.indexOf("__isa") != null then index.remove( index.indexOf("__isa"))
	if index.indexOf("classID") != null then index.remove( index.indexOf("classID"))
	if arg1 != "-i" then
		index = index.sort
	end if

	num_commands = index.len
	columns = 8 // # commands per line
	if globals.DEBUG then print("commands: "+num_commands+" columns: "+columns)
	rows = ceil(num_commands / columns)
	if globals.DEBUG then print("rows: "+rows)
	buf = []
	count = 0
	for i in range(0,rows)
		//buf.push("<color=#FFFFFFFF><b>"+index[count:count+columns].join(" "))
		buf.push(colorWhite+index[count:count+columns].join(" "))
		count = count + columns
	end for
	print(colorGold+"- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"+CT)
	print(format_columns(buf.join(char(10))).replace("sphinx", "<color=#FF0000FF>sphinx</color>" ) )
	print(colorGold+"- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"+CT)
	print(":><b> help</b> -- print this page: lists commands alphabetically")
	print(":><b> help guide</b> -- for a quick getting started guide")
	//print(":> help [-c|conventions] -- information about 5hell prompt conventions")
	print(":> help [-p|prompt|-c|conventions] -- information about 5hell prompt conventions")
	print(":> help [-t|tools] -- a short list of the main tools")
	print(":> help [-a|automation] -- print information about automating tasks")
	print(":> help [-d|daemon|daemons] -- information about daemon control")
	print(":> help [-A|alias] -- a list of the current default aliases in 5hell.src")
	print(colorOrange+":> help [-b|buffer] -- buffer, clipboard, and custom_object info")
	print(":> help [-l|logs] -- information regarding system.log")
	print(":> help [-s|show|search] -- for a full descriptive list of commands")
	print(colorCyan+":> help [-s|show|search] [word|string|regex] -- search all help info for pattern"+char(10)+"-- see grep -h for regex tokens")
	print(":> help [-i] -- list commands by command map index")
	print(":> help [home] -- information about the @home system")
	print(":> lock -- shortcut for perms lock all")
	print(":> prompt -- toggle full_prompt on and off")
	print(colorCyan+":> [command] [-h|help] -- for more information on a specific command."+char(10))
	return 0
end function
//////////////
////////////// 5phinx F1 usage info ////////////
//////
sphinx_help = function()
	print(colorRed+"Sphinx</color> v" + sphinx_version + ",<color=white> by Plu70   </b></color>running on localhost: "+localmachine.local_ip)
  print("<b>////////////////////////////////////////////</b>"+CT)
  print("<b>Press the key in </b>[ ]<b>'s to activate a command:")
  print("A MetaLib is a scanned library (e.g. libssh 1.0.1) aka a<b> lib </b>")
  print("A vuln is a vulnerability in a MetaLib that may be exploited")
  print
  print(colorWhite+"To begin, select an ip and port to target:")
  print(colorCyan+"</b>["+colorWhite+"4</b></color>] or ["+colorWhite+"i</b></color>] - set target IP and port \n-- <b>leave blank to default to current gateway")
  print(colorCyan+"</b>["+colorWhite+"5</b></color>] or ["+colorWhite+"p</b></color>] - manually change target port without changing target IP")
  print(colorCyan+"</b>["+colorWhite+"0</b></color>] or ["+colorWhite+"w</b></color>] - port scan (nmap) target IP"+char(10)+
  "-- if target IP is not a router, 5phinx will attempt to locate the router, halfheartedly")
  print(colorCyan+"</b>["+colorWhite+"+</b></color>] or ["+colorWhite+"=</b></color>] - connect or load MetaLib"+char(10)+
  "--: [<b>y</b>] or <b>enter</b> establishes a net_session</b> "+char(10)+
  "--: this leaves a connection established log on servers but not on routers"+char(10)+
  "--: selecting [<b>l</b>] instead loads a <b>local lib</b> for scanning/exploiting")
  print("--: if the target MetaLib is known in the database 5phinx will automatically link the entry\n--: and load the vulns (xploits) into memory")
  print("["+colorWhite+"-</b></color>] - will unload the currently loaded MetaLib and clear vulns in memory")
  print(colorCyan+"</b>["+colorWhite+"1</b></color>] or ["+colorWhite+"s</b></color>] - scan MetaLib at target IP:port and load vulns (xploits) into memory."+char(10)+
  "--: this does <u>not</u> update the database"+char(10)+
  "--: while the vuln requirements may be viewed in malp option [2] "+char(10)+
  "--: the information is not stored"+char(10)+
  "--: this is useful if you: want to scan a target without writing to the target's filesystem"+char(10)+
  "--: or you want to scan a target without overwriting you current database entry")
  print(colorCyan+"</b>["+colorWhite+"2</b></color>] or ["+colorWhite+"r</b></color>] - perform 'hail mary' attack using all vulns (xploits) loaded into memory"+char(10)+
  "--: does not database results")
  print(colorCyan+"<b>["+colorWhite+"3</b></color>] or ["+colorWhite+"d</b></color>] - scans the target IP and port"+char(10)+
  "--: if a local metaLib has been loaded with [<b>=</b>] then db will database that instead of the target IP"+char(10)+
  "--: attacks using all exploits found"+char(10)+
  "--: <b>updates the database</b> with the results</b>"+char(10)+
  "--: loads vulns (xploits) to memory"+char(10)+
  "--: will overwrite the entry if a lib is databased again"+char(10)+
  "--: it is not necessary to link a remote lib with [=] to use db on a remote target") 
  print(colorCyan+"["+colorWhite+"a</b></color>] - select a single attack from memory to launch at the target"+char(10)+
  "--: the same as the <b>zap</b> command"+char(10)+
  "--: to manually enter a [mem] [string] press enter at the menu and fill in the values")
  print(colorCyan+"</b>["+colorWhite+".</b></color>] - run the <b>dig</b> command against the target (see dig -h)"+char(10)+
  "--: if dig.bat is not in rkit, a very basic dig.bat will be created"+char(10)+
  "--: edit dig.bat to perform whatever tasks you want dig to auto-execute when attacking the target"+char(10)+
  "--: dig uses the 'do' command to perform actions"+char(10)+
  "--: you may include instructions in dig.bat to launch other bat files with do"+char(10)+
  "--: any bat file, including dig.bat, may contain a call to shell.launch 5hell with a 'do' launch parameter"+char(10)+
  "--: this allows you to spread 5hell like the plague"+char(10)+
  "--: dig does not support digging /lib, use a do script for that")
  print(colorCyan+"</b>["+colorWhite+"*</b></color>] or ["+colorWhite+"/</b></color>] - run <b>db</b> against all libs or ports in /lib or at target IP"+char(10)+
  "--: if a local lib is linked then all libs in /lib will be databased"+char(10)+
  "--: if no lib is linked then all libs in /lib will be databased"+char(10)+
  "--: link a net_session with a port or router on the target to db all reachable ports")
  print("--:<b> all results from <b>[2], [3], [.], [*], and [a]</b> "+char(10)+
  "--: are sent to the "+colorOrange+"BUFFER</color></b> in memory alpha")
  print("[6] - access the mail command"+char(10)+
  "--: may also use the down arrow key")
  print(colorCyan+"<b>["+colorOrange+"7</b></color>] or ["+colorOrange+"m</b></color>] - access the malp command (Memory Alpha)\n--: you may also use the <u>"+colorOrange+"left_arrow</u>"+CT+" key")
  print("--: from malp select "+colorOrange+"[5] to access the BUFFER")
  print("[8] - access an extra menu, may also use the right arrow key")
  print("[9] - access bank heist, may also use the up arrow key\n--: n.b. bank heist is kinda crappy\n--: and bank accounts contain almost nothing")
  print(colorCyan+"</b>["+colorWhite+"z</b></color>] - wipe the local system.log"+char(10)+
  "--: sets log to a text file of size 0"+char(10)+
  "--: when returning to 5phinx's main menu, if the log has changed, an alert will print")
  print("["+colorWhite+"F1</b></color>] or [?] - access this help file ")
  print("[<b>q</b>] - leave 5phinx and return to 5hell \n--: preserves state so you may return"+char(10)+"--: shares state with 5hell")
  print
  print("n.b. running <b>probe [ip [port] from 5hell's cli will set the target IP and port for 5phinx")
  print("n.b. <b>zap</b>  in 5hell is the same as [<b>a</b>] in 5phinx")
  print("n.b. <b>roil</b> in 5hell is the same as [<b>2</b>] in 5phinx")
  print("n.b. <b>meta link|load</b> in 5hell is the same as [<b>=</b>]/[<b>+</b>] in 5phinx")
  print("n.b. <b>database.csv</b> is always <b>written</b> to /root/rkit/database.csv")
  print("n.b. <b>database.csv</b> may be read from anywhere (uses first copy found on system)")
  print("n.b. convention is to keep a copy of 5hell, metaxploit, crypto, database.csv"+char(10)+
  "--: in /root/rkit along with other useful tools for easy uploading"+char(10)+
  "--: you may use <b>kore -r</b> to quickly construct the rkit")
  print
  print("5hell/5phinx does not phone home and therefore does not autoupdate"+char(10)+
  "--: 5hell is now open source so the above is a moot point")
  print("5hell/5phinx is a product of Ra'al Tek and is written by jhook777 aka Plu70 aka Ra'al")
  print("all rights reserved 2020-2025")
  print
end function
///////////////// end 5phinx help ////////////
//
////////////////// GAMES ///////////////
  // start games made by Plu70
  bat = function(s)
      // battleship by Plu70, aka ra'al, aka jhook777  2021
      // start with 10 x 10 grid
      // 24.905kb
      // valid launch params:
      //
      // -c -- all color lines are null
      // -d -- debug mode, no wait(1)'s and verbose
      // -dt - early terminate: spawn ships, print locations and end
      // -s -- self play: ai vs rng
      // -cd, -cd -s, -d -s, -c -s, also valid combinations
      //
      // order matters with launch params
      // ai is marginally better than random*
      ////////////////////////
      game_file = null  // single player for now
      DIFFICULTY = "hard" // lol jk, still need better ai algorithm. easy or medium available at runtime
      EARLYTERM = false
      self_play = false
      //if params.len >= 1 and (params[0] == "-s" or params [1] == "-s") then self_play = true
      //debug = globals.DEBUG
      disable_color = false
      
      /////////
      if s == "-s" then self_play = true
      ////////////////////////
      globals.MIN = 0 // minimum X/Y values for grid size
      globals.MAX = 9 // maximum X/Y values for grid size
      rng = range(MIN,MAX)
      rnd = range(MIN,MAX)
      rng.shuffle
      rnd.shuffle
      
      ///BEGIN GRAPHICS//////
      
      print_logo = function()
          print(colorRed+" _           _   _   _           _     _         "+CT)
          print(colorGreen+"| |         | | | | | |         | |   (_)       "+CT)
          print(colorGreen+"| |__   __ _| |_| |_| | ___  ___| |__  _ _ __   "+CT)
          print(colorGreen+"| '_ \ / _` | __| __| |/ _ \/ __| '_ \| | '_ \  "+CT)
          print(colorRed+"| |_) | (_| | |_| |_| |  __/\__ \ | | | | |_) | "+CT)
          print(colorGreen+"|_.__/ \__,_|\__|\__|_|\___||___/_| |_|_| .__/  "+CT)
          print(colorGreen+"                                       | |      "+CT)
          print(colorGreen+"                                       |_|      "+CT)
      
      end function
      
      display_ship_one = function()
      
          ship_one = ["                                                                       .",	"                                     # #  ( )                           ","                                  ___#_#___|__                          ",	"                              _  |____________|  _                      ",	"                       _=====| | |            | | |==== _               ",	"                 =====| |.---------------------------. | |====          ",	"   <--------------------'   .  .  .  .  .  .  .  .   '--------------/   ",	"     \                                                             /    ",	colorLightBlue+"  wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww "+CT,	colorLightBlue+"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"+CT,	colorLightBlue+"   wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww  "+CT]
          for ln in ship_one
              print(ln)
          end for
      end function
      
      display_ship_two = function()
      
          ship_two = ["                                                                               ","                                     |__                                       ",	"                                     |\/                                       ",	"                                     ---                                       ",	"                                     / | [                                     ",	"                              !      | |||                                     ",	"                            _/|     _/|-++'                                    ",	"                        +  +--|    |--|--|_ |-                                 ",	"                     { /|__|  |/\__|  |--- |||__/                              ",	"                    +---------------___[}-_===_.'____                 /\       ",	"                ____`-' ||___-{]_| _[}-  |     |_[___\==--            \/   _   ",	" __..._____--==/___]_|__|_____________________________[___\==--____,------' .7 ",	"|                                                                     BB-61/   ",	" \_________________________________________________________________________|   ",	colorLightBlue+"  Matthew Bacewwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"+CT,	colorLightBlue+"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"+CT	]
          for ln in ship_two
              print(ln)
          end for
      end function
      
      display_ship_three = function()
          // stub
      end function
      
      display_long_rule = function()
          print(colorGreen+"</b>[.0....1....2.....3....4.....5....6....7.....8....9.]</color>")  // adjust this to fit your terminal
      end function
      /////END GRAPHICS /////////
      
      /////// SANITY CHECK /////
      check_sanity = function(sobj) // ensure ships don't overlap
          if globals.DEBUG then print("Checking Sanity...")
          if globals.DEBUG then print(sobj.frigate)
          if globals.DEBUG then print(sobj.cruiser)
          if globals.DEBUG then print(sobj.battleship)
      
          bshipX = sobj.battleship.X
          bshipY = sobj.battleship.Y
          cshipX = sobj.cruiser.X
          cshipY = sobj.cruiser.Y
          fshipX = sobj.frigate.X
          fshipY = sobj.frigate.Y
      
          if globals.DEBUG then print( bshipX  )
      
          collision = 0
          static_ship = "battleship"
      
          for fx in fshipX
              if fx > globals.MAX then collision = "out_of_bounds"
              if cshipX.indexOf(fx) >= 0 then
                  for fy in fshipY
                      if cshipY.indexOf(fy) >= 0 then
                          collision = "frigate"
                          static_ship = "cruiser"
                          if fy > globals.MAX then collision = "out_of_bounds"
                      end if
                  end for
              end if
          end for
      
          for bx in bshipX
              if bx > globals.MAX then collision = "out_of_bounds"
              if globals.DEBUG then print("bx:"+bx)
              if globals.DEBUG then print("cruiser: index of bx: "+cshipX.indexOf(bx))
              if cshipX.indexOf(bx) >= 0 and cshipX.hasIndex(cshipX.indexOf(bx)) then
                  for by in bshipY
                      if globals.DEBUG then print("by:"+by)
                      if cshipY.indexOf(by) >= 0 and cshipY.hasIndex(cshipY.indexOf(by)) then collision = "cruiser"
      
                  end for
              end if
      
              if fshipX.indexOf(bx) >= 0 then
                  for by in bshipY
                      if fshipY.indexOf(by) >= 0 then collision = "frigate"
                      if by > globals.MAX then collision = "out_of_bounds"
                  end for
              end if
      
          end for
          for cx in cshipX
              if cx > globals.MAX then collision = "out_of_bounds"
          end for
          for cy in cshipY
              if cy > globals.MAX then collision = "out_of_bounds"
          end for
          if globals.DEBUG then print("coll:"+collision)
          if collision then
              if globals.DEBUG then print("Handling collision between "+static_ship+" and "+collision+"...")
              // this tactic is known as 'do something, even if it's wrong'
              nX = sobj[collision]["X"]
              nY = sobj[collision]["Y"]
              if nX.len > nY.len then
                  if nY[0] <= 0 then nY[0] = 3
                  if nY[0] >= 9 then nY[0] = 5
                  if nY[0] == 2 or nY[0] == 4 or nY[0] == 6 then nY[0] = nY[0] + 1
                  rr = range(-1,1)
                  rr.shuffle
                  nY[0] = nY[0] + rr.pop
                  if nY[0] > globals.MAX then collision = "out_of_bounds"
              else
                  if nX[0] <= 0 then nX[0] = 3
                  if nX[0] >= 9 then nX[0] = 5
                  if nX[0] == 2 or nX[0] == 4 or nX[0] == 6 then nX[0] = nX[0] + 1
                  rr = range(-1,1)
                  rr.shuffle
                  nX[0] = nX[0] + rr.pop
                  if nX[0] > globals.MAX then collision = "out_of_bounds"
              end if
          end if
          //////
          if globals.DEBUG then print("Handled. Back propagating...")
          if globals.DEBUG and not collision then print("Sanity check complete.")
          return collision// true for recursion or false if no collisions and sane
      end function
      //// END SANITY CHECK //////
      
      map = {}
      map.grid = []
      map.make = function()
          map.grid = range(globals.MIN,globals.MAX)
          for e in range(globals.MIN,globals.MAX)
              map.grid[e] = range(globals.MIN,globals.MAX)
              for c in map.grid[e]
                  if globals.DEBUG then
                      map.grid[e][c] = e+","+c
                  else
                      map.grid[e][c] = colorLightBlue+"www"+CT
                  end if
              end for
          end for
      end function
      map.get_cell = function(x,y)
          return map["grid"][x][y]
      end function
      map.edit_cell = function(xy,beef,actor)
          split = xy.split(" ")
          if split.len < 2 then
              split.push("0")
              if split.len < 2 then
                  split.push("0")
              end if
          end if
          x = split[0].val
          y = split[1].val
          edit = "www"
          if beef > 0 then // hit
              if actor == computa.label then
                  edit = colorOrange+"***"+CT
              else
                  edit = colorRed+"***"+CT
              end if
          else
              if beef == 0 then // miss
                  if actor == computa.label then
                      edit = colorLightBlue+"###"+CT
                  else
                      edit = colorWhite+"###"+CT
                      if map["grid"][x][y] == colorLightBlue+"###"+CT then edit = (colorWhite+"#"+CT+colorLightBlue+"#"+CT+colorWhite+"#"+CT)
                  end if
              end if
          end if
          if globals.DEBUG then print("X:"+x+" Y:"+y+" edit:"+edit)
          if map["grid"][x][y] == (colorRed+"***"+CT) then
              if beef then
                  edit = colorRed+"*"+CT+colorOrange+"*"+CT+colorRed+"*"+CT
              else
                  return beef
              end if
          end if
          if beef and map["grid"][x][y] == colorOrange+"***"+CT then edit = colorRed+"*"+CT+colorOrange+"*"+CT+colorRed+"*"+CT
          if not beef and map["grid"][x][y] == colorOrange+"***"+CT then edit = (colorWhite+"#"+CT+colorOrange+"#"+CT+colorWhite+"#"+CT)
          if not beef and map["grid"][x][y] == (colorWhite+"###"+CT) then edit = (colorWhite+"#"+CT+colorLightBlue+"#"+CT+colorWhite+"#"+CT)
          map["grid"][x][y] = edit
          return beef
      end function
      map.display_grid = function()
          buf = ""
          y = globals.MAX
          while y >= globals.MIN
              for x in range(globals.MIN,globals.MAX)
                  buf = buf + "." + map.get_cell(x,y) + "."
              end for
              buf = buf + colorGreen+"</b>.["+y+"]</color>"+ char(10)
              y = y - 1
          end while
          print(buf)
          display_long_rule
      end function
      map.make
      
      
      
      player = {}
      player.label = ""
      player.opponent = ""
      player.BUFFER = {}
      player.position = {}
      player.display_ship_coordinates = function()
          for c in self.position
              print(">"+c.value.label+":")
              print("[X: "+c.value.X+" Y:"+c.value.Y+"]")
          end for
      end function
      player.fire = function(coords)
          aim = coords.split(" ")
          print(colorOrange+self.label + " fires at " + aim[0] + ", " + aim[1] + " and... "+CT)
          wait(1)
          count = 0
          for ship_obj in self.opponent.position
              if globals.DEBUG then print(ship_obj)
              shipX = ship_obj.value.X
              shipY = ship_obj.value.Y
              count = count + 1
              for sx in shipX
                  if aim[0].val == sx then
                      for sy in shipY
                          if aim[1].val == sy then
                              print(colorRed+"<b>HITS!</b>"+CT+char(10))
                              summary.accuracy.update(self.label, "hit", coords)
                              return count
                          end if
                      end for
                  end if
              end for
          end for
          print("<b>MISSES!</b>"+char(10))
          summary.accuracy.update(self.label, "miss", coords)
          return 0
      end function
      player.spawn_ship = function(ship)
          top_edge = false
          bottom_edge = false
          left_edge = false
          right_edge = false
          i = 0
          if ship.hasIndex("frigate") then i = ship.frigate
          if ship.hasIndex("cruiser") then i = ship.cruiser
          if ship.hasIndex("battleship") then i = ship.battleship
          if globals.DEBUG then print("["+colorWhite+ship.label+CT+"]")
      
          transmform = function(sob)
              if sob.X[0] == globals.MIN then left_edge = true
              if sob.X[-1] == globals.MAX then right_edge = true
              if sob.Y[0] == globals.MIN then bottom_edge = true
              if sob.Y[-1] == globals.MAX then top_edge = true
              if sob.X.len > 1 then
                  top_edge = true
                  bottom_edge = true
              end if
              if sob.Y.len > 1 then
                  left_edge = true
                  right_edge = true
              end if
              vote_down = 1
              vote_up = 1
              vote_left = 1
              vote_right = 1
              if top_edge then vote_up = 0
              if bottom_edge then vote_down = 0
              if left_edge then vote_left = 0
              if right_edge then vote_right = 0
              rn = range(1,10) // do not set globals.MIN to zero
              rn.shuffle
              vote_up = (vote_up * rn.pop)
              if globals.DEBUG then print(vote_up+":up")
              rn.shuffle
              vote_down = (vote_down * rn.pop)
              if globals.DEBUG then print(vote_down+":down")
              rn.shuffle
              vote_right = (vote_right * rn.pop)
              if globals.DEBUG then print(vote_right+":right")
              rn.shuffle
              vote_left = (vote_left * rn.pop)
              if globals.DEBUG then print(vote_left+":left")
              tally = [vote_up,vote_down,vote_left,vote_right]
              tally.sort
              tally.reverse
              winner = tally[0]
              if globals.DEBUG then print(winner)
              if winner == 0 then return
              if winner == vote_up then //up
                  sob.Y.push(sob.Y[-1]+1)
                  sob.Y.sort
                  return
              end if
              if winner == vote_down then //down
                  sob.Y.push(sob.Y[0]-1)
                  sob.Y.sort
                  return
              end if
              if winner == vote_left then // left
                  sob.X.push(sob.X[0]-1)
                  sob.X.sort
                  return
              end if
              if winner == vote_right then //right
                  sob.X.push(sob.X[-1]+1)
                  sob.X.sort
                  return
              end if
          end function
      
          while i > 0
              transmform(ship)
              i = i - 1
          end while
      end function
      
      player1 = new player
      player1.label = "Player"
      player1.BUFFER = {}
      player1.position = {}
      player1.position.frigate = {"X":[0], "Y":[0], "frigate":1, "label":"frigate"}
      player1.position.cruiser = {"X":[0], "Y":[0], "cruiser":2, "label":"cruiser"}
      player1.position.battleship = {"X":[0], "Y":[0], "battleship":4, "label":"battleship"}  // position ship then spawn_ship
      player1.setup = function(x,y)
          self.position.frigate.X[0] = x[0]
          self.position.frigate.Y[0] = y[0]
          x.shuffle
          y.shuffle
          self.position.cruiser.X[0] = x[0]
          self.position.cruiser.Y[0] = y[0]
          x.shuffle
          y.shuffle
          self.position.battleship.X[0] = x[0]
          self.position.battleship.Y[0] = y[0]
          self.spawn_ship(self.position.frigate)
          self.spawn_ship(self.position.cruiser)
          self.spawn_ship(self.position.battleship)  // position ship then spawn_ship
          while check_sanity(self.position)
          end while
      end function
      player1.confirm = function(cmd)
          // cmd is user_input so respond only to correct input and drop all else
          if cmd == "" then cmd = "0 0"
          aim = cmd.split(" ")
          if aim.len < 2 then
              aim.push("0")
              if aim.len < 2 then
                  aim.push("0")
              end if
          end if
          aim[0] = aim[0].val
          aim[1] = aim[1].val
          cmd = aim.join(" ")
          if player1.BUFFER.hasIndex(cmd) then
              print(colorOrange+"That would be a waste of ammunition!"+CT)
              return 0 // command denied
          else
              player1.BUFFER.push(cmd)
          end if
          aim = cmd.split(" ")
          if aim[0].val > globals.MAX or aim[1].val > globals.MAX or aim[0].val < globals.MIN or aim[1].val < globals.MIN then
              print(colorOrange+"</b>Target designation is out of bounds!</color>")
              return 0
          end if
          return cmd // confirmed command
      end function
      
      
      /// BEGIN Computa
      computa = new player
      computa.label = "Computa"
      computa.BUFFER = {}
      computa.position = {}
      computa.position.frigate = {"X":[0], "Y":[0], "frigate":1, "label":"frigate"} // x_array, y_array, label:# of transorms in spawn_ship
      computa.position.cruiser = {"X":[0], "Y":[0], "cruiser":2, "label":"cruiser"} // adjust check_score when adding new ship classes!
      computa.position.battleship = {"X":[0], "Y":[0], "battleship":4, "label":"battleship"} // position ship then spawn_ship
      computa.AI = {}
      computa.AI.ghost_ship = {}
      computa.AI.ghost_ship.frigate = {"X":[1], "Y":[1], "frigate":1, "label":"ghost_frigate"}
      computa.AI.ghost_ship.cruiser = {"X":[8], "Y":[8], "cruiser":2, "label":"ghost_cruiser"}
      computa.AI.ghost_ship.battleship = {"X":[5], "Y":[5], "battleship":4, "label":"ghost_battleship"}
      computa.AI.c_list = []
      computa.wake_AI = function()
          self.spawn_ship(self.AI.ghost_ship.battleship)
          self.spawn_ship(self.AI.ghost_ship.frigate)
          self.spawn_ship(self.AI.ghost_ship.cruiser)
          t_x = []
          t_y = []
          t_cmd = ""
          for s in self.AI.ghost_ship
              t_x = s.value.X
              t_y = s.value.Y
              t_cmd = t_x[0]+" "+t_y[0]
              self.AI.c_list.push(t_cmd)
          end for
      end function
      computa.setup = function(x,y)
          self.position.frigate.X[0] = x[0]
          self.position.frigate.Y[0] = y[0]
          x.shuffle
          y.shuffle
          self.position.cruiser.X[0] = x[0]
          self.position.cruiser.Y[0] = y[0]
          x.shuffle
          y.shuffle
          self.position.battleship.X[0] = x[0]
          self.position.battleship.Y[0] = y[0]
          self.spawn_ship(self.position.frigate)
          self.spawn_ship(self.position.cruiser)
          self.spawn_ship(self.position.battleship)  // position ship then spawn_ship
          while check_sanity(self.position)
          end while
      end function
      computa.AI.update_ghosts = function(new_X, new_Y, new_T)
          self.ghost_ship.frigate.X = new_X
          self.ghost_ship.frigate.Y = new_Y
          self.ghost_ship.cruiser.X = new_X
          self.ghost_ship.cruiser.Y = new_Y
          self.ghost_ship.battleship.X = new_X
          self.ghost_ship.battleship.Y = new_Y
          self.ghost_ship.frigate.frigate = new_T
          self.ghost_ship.cruiser.cruiser = new_T
          self.ghost_ship.battleship.battleship = new_T
          computa.spawn_ship(self.ghost_ship.frigate)
          computa.spawn_ship(self.ghost_ship.cruiser)
          computa.spawn_ship(self.ghost_ship.battleship)
      end function
      computa.AI.alpha = function()
          last_shot = summary.accuracy.Computa.hist[-2]
          if globals.DEBUG then print("last shot: "+last_shot)
          last_action = summary.accuracy.Computa.hist[-1]
          if self.c_list.len < 1  or last_action == "hit" then //c_list_empty = true
              new_C = last_shot.split(" ")
              if globals.DEBUG then print(new_C)
              new_x = [new_C[0].val]
              new_y = [new_C[1].val]
              new_t = 0
              if last_action == "miss" then
                  new_t = 6
              else
                  new_t = 2
              end if
              self.purge_ghosts
              self.update_ghosts(new_x,new_y, new_t)
              t_x = []
              t_y = []
              t_cmd = ""
              for s in self.ghost_ship
                  t_x = s.value.X
                  t_y = s.value.Y
                  t_y.shuffle
                  t_x.shuffle
                  t_cmd = t_x[0]+" "+t_y[0]
                  if globals.DEBUG then print("Pushing "+t_cmd+" to c_list...")
                  if not self.c_list.hasIndex(t_cmd) then self.c_list.push(t_cmd)
              end for
          end if
          if self.c_list.len < 1 then // panic
              rng.shuffle
              rnd.shuffle
              t_cmd = [rng[0], rnd[0]]
              t_cmd = t_cmd.join(" ")
              self.c_list.push(t_cmd)
          end if
          self.c_list.shuffle
          return  self.c_list.pop // string of type "X Y" where X and Y are within outer.MIN, MAX
      end function
      computa.AI.panic_level = 4
      computa.AI.purge_ghosts = function()
          self.ghost_ship.frigate.X = []
          self.ghost_ship.frigate.Y = []
          self.ghost_ship.cruiser.X = []
          self.ghost_ship.cruiser.Y = []
          self.ghost_ship.battleship.X = []
          self.ghost_ship.battleship.Y = []
      end function
      computa.AI.omega = function() // when computa has found all three of Payer1's ships
          last_shot = summary.accuracy.Computa.hist[-2]
          hl = summary.accuracy.Computa.hit_list
          if globals.DEBUG then print("hit_list: "+hl)
          last_action = summary.accuracy.Computa.hist[-1]
          if self.c_list.len < 1  or last_action == "hit" then
              hl.shuffle
              new_C = hl[0].split(" ")
              if globals.DEBUG then print(new_C)
              new_x = [new_C[0].val]
              new_y = [new_C[1].val]
              new_t = 0
              if last_action == "miss" then
                  new_t = 2
              else
                  new_t = 1
              end if
              self.purge_ghosts
              self.update_ghosts(new_x,new_y, new_t)
              t_x = []
              t_y = []
              t_cmd = ""
              for s in self.ghost_ship
                  t_x = s.value.X
                  t_y = s.value.Y
                  t_y.shuffle
                  t_x.shuffle
                  t_cmd = t_x[0]+" "+t_y[0]
                  if globals.DEBUG then print("Pushing "+t_cmd+" to c_list...")
                  if not self.c_list.hasIndex(t_cmd) then self.c_list.push(t_cmd)
              end for
          end if
          if self.c_list.len < 1 then // panic
              rng.shuffle
              rnd.shuffle
              t_cmd = [rng[0], rnd[0]]
              t_cmd = t_cmd.join(" ")
              self.c_list.push(t_cmd)
          end if
          self.c_list.shuffle
          return  self.c_list.pop // string of type "X Y" where X and Y are within outer.MIN, MAX
      end function
      computa.get_command = function() // obvious stub needs obvious improvement
          ccommand = ""
          if DIFFICULTY == "easy" then
              ccommand = [rng[0], rnd[0]]
              ccommand = ccommand.join(" ")
          else
              if computa.score[0] > 0 and computa.score[1] > 0  and computa.score[2] > 0 then
                  // all ships found, prepare for gg
                  ccommand = self.AI.omega
              else
                  //if computa.score[0] > 0 or computa.score[1] > 0  or computa.score[2] > 0 then
                      //ccommand = [rng[0], rnd[0]]
                      //ccommand = ccommand.join(" ")
              //	else
                      ccommand = self.AI.alpha
                  //end if
              end if
          end if
          if globals.DEBUG then print("sending: "+ccommand)
          rng.shuffle
          rnd.shuffle
          if self.BUFFER.hasIndex(ccommand) then
              if globals.DEBUG then print("!!Repeat detected!!")
              self.AI.panic_level = 8
              ccommand = false
              //return ccommand
          else
              self.BUFFER.push(ccommand)
              self.AI.panic_level = 4
              //return ccommand
          end if
          return ccommand
      end function
      //// END Computa
      
      
      if globals.DEBUG then print("Initializing players...")
      rng = range(MIN,MAX)
      rnd = range(MIN,MAX)
      
      rng.shuffle
      rnd.shuffle
      
      computa.setup(rng,rnd)
      computa.wake_AI
      
      rnd.shuffle
      rng.shuffle
      
      if globals.DEBUG then print("...readying player1...")
      player1.setup(rng,rnd)
      
      player1.opponent = computa
      computa.opponent = player1
      
      player1.score = [0,0,0] // [frigate,cruiser,battleship]
      computa.score = [0,0,0] // [2_tokill,3 tokill,5 tokill] (transorms + 1 to kill)
      check_score = function(bit,act)
          if globals.DEBUG then print("Scoring...")
          if globals.DEBUG then print(act+":"+bit)
          if act == player1.label then
              if not bit then return 1
              player1.score[bit-1] = player1.score[bit-1] + 1
              if player1.score.sum == 10 then return 0 // command BUFFER restricts repeat shots
              return 1
          else
              if not bit then return 1
              computa.score[bit-1] = computa.score[bit-1] + 1
              if computa.score.sum == 10 then return 0
              return 1
          end if
      end function
      
      DATASET = {}
      DATASET.accuracy = {}
      DATASET.accuracy.Computa = {}
      DATASET.accuracy.Player = {}
      summary = new DATASET
      summary.purge = function()
          if globals.DEBUG then print("purging...")
          self.accuracy.Computa.hist = []
          self.accuracy.Player.hist = []
      end function
      summary.accuracy.update = function(lbl, event, crds)
          //summary.purge
          if globals.DEBUG then print("updating..."+lbl)
          if lbl == self.Player.label and globals.DEBUG then print("player found!")
          summary["accuracy"][lbl]["hist"].push(crds)
          if globals.DEBUG then print(crds)
          if event == "hit" then // hit
              summary["accuracy"][lbl]["Hits"] = summary["accuracy"][lbl]["Hits"] + 1
              if globals.DEBUG then print("pushing "+crds+" to hit_list...")
              summary["accuracy"][lbl]["hit_list"].push(crds)
          else // miss
              summary["accuracy"][lbl]["Misses"] = summary["accuracy"][lbl]["Misses"] + 1
          end if
          summary["accuracy"][lbl]["hist"].push(event)
      end function
      summary.accuracy.report = function()
          if globals.DEBUG then print("reporting...")
          last_computer_shot = self.Computa.hist
          last_player_shot = self.Player.hist
          if last_computer_shot[-1] == "hit" then
              revent = (colorRed+"<b>HIT!</b>"+CT)
          else
              revent = "<b>MISSED!</b>"
          end if
          print(colorOrange+self.Computa.label+" fired at "+last_computer_shot[-2]+" and "+revent)
          if last_player_shot[-1] == "miss" then
              revent = "<b>MISSED!</b>"
          else
              revent = (colorRed+"<b>HIT!</b>"+CT)
          end if
          print(colorOrange+self.Player.label+" fired at "+last_player_shot[-2]+" and "+revent)
      end function
      summary.widget = function()
          l = self.accuracy.Player.label
          h = self.accuracy.Player.Hits
          m = self.accuracy.Player.Misses
          s = m+h
          print(colorWhite+"|"+l+" accuracy: "+ h +colorGreen+"/"+colorWhite+s+"|"+CT)
      end function
      summary.accuracy.init = function()
          self.Computa = {"label":"Computa", "Hits":0, "Misses":0, "hist":["nothing",0], "hit_list":[]}
          self.Player = {"label":"Player", "Hits":0, "Misses":0, "hist":["nothing",0], "hit_list":[]}
      end function
      summary.accuracy.init
      
      
      if globals.DEBUG then print("...init complete. Starting main...")
      ////// BEGIN MAIN /////////
      battleship = function()
          playing = true
          first_run = true
          if EARLYTERM then playing = false
          if globals.DEBUG and EARLYTERM then player1.display_ship_coordinates
          if globals.DEBUG and EARLYTERM then computa.display_ship_coordinates
          if user_input("Select a difficulty level:"+char(10)+"[EASY] - Commander Rander"+char(10)+"[MEDIUM] - Captain Chao "+char(10)+["||: "]).lower != "EASY" then
              print("MEDIUM difficulty selected. Good luck!")
              DIFFICULTY = "medium"
          else
              print("EASY difficulty selected. Good luck!")
              DIFFICULTY = "easy"
          end if
          ///// game starts here
          while playing
              if not globals.DEBUG then print(" ",1)
              if not first_run then print_logo
      
              player1.display_ship_coordinates
              if globals.DEBUG then computa.display_ship_coordinates
              if not first_run then summary.accuracy.report
              if globals.DEBUG then print(player1.score)
              if globals.DEBUG then print(computa.score)
              print(colorGreen+"</b>//////////////////////////////////////////////////////</color>")
      
              map.display_grid
              if not first_run then summary.widget
      
              first_run = false
              command = 0
              if self_play then
                  rng.shuffle
                  rnd.shuffle
                  command = [rng[0], rnd[0]]
                  command = command.join(" ")
                  if not globals.DEBUG then wait(1)
              else
                  print("q=quit")
                  command = user_input("Enter coordinates [0-9] as [x y]: ")
                  if command.lower == "q" then return "abandoning ship..."
              end if
              command = player1.confirm(command)
              if command == 0 then continue // belay that order!
              if not globals.DEBUG then 
                wait .1
                print(" ",1)
              end if
              display_ship_one
              playing = check_score(map.edit_cell(command, player1.fire(command), player1.label), player1.label)
      
              if not playing then return("<b>You sunk all of computa's battleships! You Win!</b>")
      
              rng.shuffle // vestigial shuffle
              rnd.shuffle // vestigial shuffle
              wait(1)
              if not globals.DEBUG then clear_screen
      
              display_ship_two
              ai_turn = true
              while ai_turn
                  command = computa.get_command
                  if globals.DEBUG then print("...recieved: "+command)
                  if command == false then continue
                  playing = check_score(map.edit_cell(command, computa.fire(command), computa.label), computa.label)
                  if not playing then return("<b>Computa sunk all of your battleships! You lose!</b>")
                  ai_turn = false
                  wait(1)
                  if not globals.DEBUG then clear_screen
              end while
          end while
      end function
      
      print_logo
      return battleship
  end function

  ///////////////////////////BLACKJACK/////////////////////////////
  ////////////////////////////////////////////////////////////////

  g2 = function()
      // Jokers Wild Blackjack by Plu70 (aka raal, aka jhook777)
      // feel free to use the deck in your own games!
      //localhost = get_shell
      //localmachine = localhost.host_computer
  
    // START 3nigma DECK /////////////////////////////////
    RC = "<color=red>"
    BC = "<color=#606060>"
    GC = "<color=green><b>"
    OC = "<color=#FF8400FF>"
    CW = "<color=white>"
    CLB = "<color=#2382FFFF><b>"
    CC = "</color>"
    SU = ["V","^","+","&"] // ace: heart, spade, diamond, club; index: 1, 14, 27, 40
    //cards = params[0].split(",")
    //cards.pull
    //num_cards = cards.len - 1
    Deck = {}
    i = 1
    C = null
    Deck[0] = RC+" _____ "+CC+"::"+RC+"|@  .^|"+CC+"::"+BC+"| @ {)|"+CC+"::"+RC+"|   $$|"+CC+"::"+BC+"|  *__|"+CC+"::"+RC+"|__JJ[|"+CC
    for S in SU
      if S == "V" or S == "+" then C = RC
      if S == "^" or S == "&" then C = BC
      for N in range(1,13)
        if N == 1 and S == "V" then Deck[i] = C+" _____ "+CC+"::"+C+"|A_ _ |"+CC+"::"+C+"|( v )|"+CC+"::"+C+"| \ / |"+CC+"::"+C+"|  .  |"+CC+"::"+C+"|____V|"+CC
        if N == 1 and S == "^" then Deck[i] = C+" _____ "+CC+"::"+C+"|A .  |"+CC+"::"+C+"| /.\ |"+CC+"::"+C+"|(_._)|"+CC+"::"+C+"|  |  |"+CC+"::"+C+"|____V|"+CC
        if N == 1 and S == "+" then Deck[i] = C+" _____ "+CC+"::"+C+"|A ^  |"+CC+"::"+C+"| / \ |"+CC+"::"+C+"| \ / |"+CC+"::"+C+"|  .  |"+CC+"::"+C+"|____V|"+CC
        if N == 1 and S == "&" then Deck[i] = C+" _____ "+CC+"::"+C+"|A _  |"+CC+"::"+C+"| ( ) |"+CC+"::"+C+"|(_'_)|"+CC+"::"+C+"|  |  |"+CC+"::"+C+"|____V|"+CC
        if N == 2 then Deck[i] = C+" _____ "+CC+"::"+C+"|2    |"+CC+"::"+C+"|  "+S+"  |"+CC+"::"+C+"|     |"+CC+"::"+C+"|  "+S+"  |"+CC+"::"+C+"|____Z|"+CC
        if N == 3 then Deck[i] = C+" _____ "+CC+"::"+C+"|3    |"+CC+"::"+C+"| "+S+" "+S+" |"+CC+"::"+C+"|     |"+CC+"::"+C+"|  "+S+"  |"+CC+"::"+C+"|____E|"+CC
        if N == 4 then Deck[i] = C+" _____ "+CC+"::"+C+"|4    |"+CC+"::"+C+"| "+S+" "+S+" |"+CC+"::"+C+"|     |"+CC+"::"+C+"| "+S+" "+S+" |"+CC+"::"+C+"|____h|"+CC
        if N == 5 then Deck[i] = C+" _____ "+CC+"::"+C+"|5    |"+CC+"::"+C+"| "+S+" "+S+" |"+CC+"::"+C+"|  "+S+"  |"+CC+"::"+C+"| "+S+" "+S+" |"+CC+"::"+C+"|____S|"+CC
        if N == 6 then Deck[i] = C+" _____ "+CC+"::"+C+"|6    |"+CC+"::"+C+"| "+S+" "+S+" |"+CC+"::"+C+"| "+S+" "+S+" |"+CC+"::"+C+"| "+S+" "+S+" |"+CC+"::"+C+"|____9|"+CC
        if N == 7 then Deck[i] = C+" _____ "+CC+"::"+C+"|7    |"+CC+"::"+C+"| "+S+" "+S+" |"+CC+"::"+C+"|"+S+" "+S+" "+S+"|"+CC+"::"+C+"| "+S+" "+S+" |"+CC+"::"+C+"|____L|"+CC
        if N == 8 then Deck[i] = C+" _____ "+CC+"::"+C+"|8    |"+CC+"::"+C+"|"+S+" "+S+" "+S+"|"+CC+"::"+C+"| "+S+" "+S+" |"+CC+"::"+C+"|"+S+" "+S+" "+S+"|"+CC+"::"+C+"|____8|"+CC
        if N == 9 then Deck[i] = C+" _____ "+CC+"::"+C+"|9    |"+CC+"::"+C+"|"+S+" "+S+" "+S+"|"+CC+"::"+C+"|"+S+" "+S+" "+S+"|"+CC+"::"+C+"|"+S+" "+S+" "+S+"|"+CC+"::"+C+"|____6|"+CC
        if N == 10 then Deck[i] = C+" _____ "+CC+"::"+C+"|10 "+S+" |"+CC+"::"+C+"|"+S+" "+S+" "+S+"|"+CC+"::"+C+"|"+S+" "+S+" "+S+"|"+CC+"::"+C+"|"+S+" "+S+" "+S+"|"+CC+"::"+C+"|___0I|"+CC
        if N == 11 then Deck[i] = C+" _____ "+CC+"::"+C+"|J  ww|"+CC+"::"+C+"| "+S+" {)|"+CC+"::"+C+"|   % |"+CC+"::"+C+"|   % |"+CC+"::"+C+"|__%%[|"+CC
        if N == 12 then Deck[i] = C+" _____ "+CC+"::"+C+"|Q  ww|"+CC+"::"+C+"| "+S+" {(|"+CC+"::"+C+"|   %%|"+CC+"::"+C+"|  %%%|"+CC+"::"+C+"|_%%%O|"+CC
        if N == 13 then Deck[i] = C+" _____ "+CC+"::"+C+"|K  WW|"+CC+"::"+C+"| "+S+" {)|"+CC+"::"+C+"|   %%|"+CC+"::"+C+"|  %%%|"+CC+"::"+C+"|_%%%>|"+CC
        i = i+1
      end for
    end for
    // END 3nigma DECK  ////////////////
  
    // START display ///
    send_display = function(cards)
      cards = cards.split(",")
      cards.pull
      line = range(0,5)
      display = range(0,5)
      for e in line
        for card in cards
          //if card == "0" then continue
          cardf = Deck[card.val].split("::")
          if display[e] == e then
            display[e] = cardf[e]
          else
            display[e] = display[e] + " " + cardf[e]
          end if
        end for
      end for
      for l in display
        print(l)
      end for
    end function
    // END display ////
  
    // END client services ///  split here!
  
    // START server ///
    // START DECK ////////////////////////
    deck = {}
    suits = ["hearts","spades","diamonds","clubs"]
    trumps = ["jack","queen","king"]
    deck[0] = {"joker":"joker"}
    i = 1
    for s in suits
      if i == 1 or i == 14 or i == 27 or i == 40 then
        deck[i] = {"ace":s}
        i =  i + 1
      end if
      for r in range(2,10)
        deck[i] = {r:s}
        i = i + 1
      end for
      for t in trumps
        deck[i] = {t:s}
        i = i + 1
      end for
    end for
    //END DECK ////////////////////////
  
  
    //for c in deck
    //	print(c.value)
    //end for
    print("Shuffling...")
    deck.shuffle
    //for c in deck
    //	print(c.value)
    //end for
    print("Shuffling...")
    deck.shuffle
    //for c in deck
    //	print(c.value)
    //end for
  
    player = {}
    player.balance = 100
    player.bet = 0
    player.hand = []
    player.total = 0
    player.has_ace = 0
  
    player.purge = function ()
      flush = self.hand.len
      for c in range(0, flush)
        self.hand.pop
      end for
      self.has_ace = 0
      self.total = 0
    end function
  
    player.calculate = function()
      //print(dealer.hand)
      total = 0
      player.has_ace = 0
      hand = player.hand
      for card in hand
        card = card.indexes
        card = card.pull
        //print(card)
        if card == "joker" then
          //player.hand.pull
          //player.hand.pull
          return 21
        end if
        if card == "ace" then
          total = total + 11
          player.has_ace = player.has_ace + 1
        else
          if card == "jack" or card == "queen" or card == "king" then
            total = total + 10
          else
            total = total + card
          end if
          //print(total)
        end if
      end for
      //print(total)
      if total < 1 then return("Stack error!")
      return total
    end function
  
    player.hit = function()
      if player.total == 21 then return false
      if player.total > 21 then
        if player.has_ace then
          while player.has_ace
            player.total = player.total - 10
            player.has_ace = player.has_ace - 1
          end while
          print("total: " + player.total + " (ace used)")
        else
          print(CLB+"player busts at: "+C+player.total)
          return false
        end if
      end if
      if player.total >= 21 then return false
      hit = user_input("[hit/stay/double]:> ")
      if hit == "hit" then
        return true
      end if
      if hit == "stay" or hit == "0" then
        print(CLB+"player stays at: "+C+player.total)
        wait(.5)
        return false
      end if
      if hit == "double" then
        player.bet = player.bet + player.bet
        return 2
      end if
      return true
    end function
  
    player.show_hand = function()
      hnd = player.hand
      c2 = "0"
      for c in hnd
        v = c.indexes
        v = v.pull
        s = c.values
        s = s.pull
        if v == "ace" then v = 1
        if v == "jack" then v = 11
        if v == "queen" then v = 12
        if v == "king" then v = 13
        if v > 0 then v = v
        //print(s)
        if s == "hearts" then s = 0
        if s == "spades" then s = 13
        if s == "diamonds" then s = 26
        if s == "clubs" then s = 39
        //print("v:"+v+" s:"+s)
        c1 = v + s
        c2 = c2 +","+ c1
      end for
  
      //print("debug: "+c2)
      //localhost.launch(localmachine.current_path+"/3deck", c2)
      send_display(c2)
      //player.hand.pull
      //player.hand.pull
    end function
  
    dealer = {}
    dealer.hand = []
    dealer.total = 0
    dealer.has_ace = 0
  
    dealer.purge = function ()
      flush = self.hand.len
      for c in range(0, flush)
        self.hand.pop
      end for
      self.has_ace = 0
      self.total = 0
    end function
  
    dealer.calculate = function()
      //print(dealer.hand)
      total = 0
      dealer.has_ace = 0
      hand = dealer.hand
      for card in hand
        card = card.indexes
        card = card.pull
        //print(card)
        if card == "joker" then
          //dealer.hand.pull
          //dealer.hand.pull
          return 21
        end if
        if card == "ace" then
          total = total + 11
          dealer.has_ace = dealer.has_ace + 1
        else
          if card == "jack" or card == "queen" or card == "king" then
            total = total + 10
          else
            total = total + card
          end if
          //print(total)
        end if
      end for
      //dealer.hand.pull
      //dealer.hand.pull
      //print(total)
      if total < 1 then return("Stack error!")
      return total
    end function
  
    dealer.hit = function()
      if dealer.total == 21 then return false
    //	if dealer.total > 21 then
    //		while dealer.has_ace
    //			dealer.total = dealer.total - 10
    //			dealer.has_ace = dealer.has_ace - 1
    //		end while
    //	end if
      if dealer.total >= 16 then
        while (dealer.has_ace and dealer.total >= 16)
          dealer.total = dealer.total - 10
          dealer.has_ace = dealer.has_ace - 1
        end while
        if dealer.total >= 16 then return false
      end if
      return true
    end function
  
    dealer.show_hand = function()
      hnd = dealer.hand
      c2 = "0"
      for c in hnd
        v = c.indexes
        v = v.pull
        s = c.values
        s = s.pull
        if v == "ace" then v = 1
        if v == "jack" then v = 11
        if v == "queen" then v = 12
        if v == "king" then v = 13
        if v > 0 then v = v
        //print(s)
        if s == "hearts" then s = 0
        if s == "spades" then s = 13
        if s == "diamonds" then s = 26
        if s == "clubs" then s = 39
        //print("v:"+v+" s:"+s)
        c1 = v + s
        c2 = c2 +","+ c1
      end for
  
        //print("debug: "+c2)
      //localhost.launch(localmachine.current_path+"/3deck", c2)
      send_display(c2)
    end function
  
  
    deal = function(pass_deck)
      i=1
      pd = pass_deck
      print("Shuffling...")
      pd.shuffle
      print("Dealing...")
      wait(.5)
      clear_screen
      dealer.hand.push(pd[i])
      dealer.hand.push(pd[i+1])
      dealer.show_hand
      dealer.total = dealer.calculate
      print(CW+"dealer: " +C+ dealer.total + " " + pd[i] + " | " + pd[i+1])
      i = i + 2
      print(GC+"-------------------------------------------"+C)
      player.hand.push(pd[i])
      player.hand.push(pd[i+1])
      player.total = player.calculate
      print(CLB+"player: " +C+ player.total + " " + pd[i] + " | " + pd[i+1])
      player.show_hand
      i = i + 2
      print
      if player.total == 21 then return 3
      hitting = true
      while hitting
        hitting = player.hit
        if hitting then
          if hitting == 2 then
            hitting = false
            print(CLB+"player doubles: "+C)
            wait(.5)
          else
            print(CLB+"player hits: "+C)
            wait(.5)
          end if
          player.hand.push(pd[i])
          player.total = player.calculate
          wait(.1)
          clear_screen
          dealer.show_hand
          print(CW+"dealer: " +C+ dealer.total)
          print(GC+"-------------------------------------------"+C)
          print(CLB+"player: " +C+ player.total)
          player.show_hand
          i = i + 1
        end if
      end while
  
      if player.total > 21 then return false
      print(GC+"-------------------------------------------"+C)
      hitting = true
      while hitting
        hitting = dealer.hit
        if hitting then
          dealer.hand.push(pd[i])
          dealer.total = dealer.calculate
          wait(.1)
          clear_screen
          print(CW+"dealer hits: "+C)
          dealer.show_hand
          print(CW+"dealer: " +C+ dealer.total)
          print(GC+"-------------------------------------------"+C)
          print(CLB+"player: " +C+ player.total)
          player.show_hand
  
          wait(.5)
          i = i + 1
        else
          print(char(10)+CW+"dealer stays at: " +C+ dealer.total)
          wait(.5)
        end if
      end while
  
      if dealer.total > 21 then
        print("dealer<b> busts</b>.")
        return true
      end if
      outcome = null
      if dealer.total > player.total then
        outcome = false
      else
        if dealer.total ==  player.total then
          outcome = 2
        else
          outcome = true
        end if
      end if
      return(outcome)
    end function
  
    blackjack = function(game_deck)
      d = game_deck
      playing = true  // this never gets set to false
      while playing
        d.shuffle
        if player.balance < 0 then
          print("Oh No! You owe the mob money! Run for your life!")
          wait(2)
          return("You didn't get away! Your legs are broken, encased in cement and you are tossed in the river.\nGame over!")
        end if
        if player.balance < 1 then return("You're broke! You have no more bucks to give.\nGame over!")  // exit condition 1
        print
        bet = user_input("Place yer bet! [balance: <b>" + player.balance + "</b>]\n  ")
        if bet == "q" or bet == "Q" or bet == "quit" or bet == "exit" then break  // exit condition 2
        if bet.val > 0 and bet.val <= player.balance then
          print("Bet of <b>"+bet.val+"</b> bucks placed.")
          player.bet = bet.val
          result = deal(d)
          dealer.purge
          player.purge
          if result then
            if result == 2 then
              print("<b>Push!</b>\n [balance unchanged]")
            else
              if result == 3 then
                print("Blackjack! Paying time-and-a-half. [<b>" + floor(player.bet * 1.5) + " </b>bucks credited to balance]")
                player.balance = player.balance + floor(player.bet * 1.5)
              else
                print("<b>You win!</b>\n [<b>" + player.bet + " </b>bucks credited to balance]")
                player.balance = player.balance + player.bet
              end if
            end if
          else
            print("<b>You lose!</b>\n [<b>" + player.bet + " </b>bucks debited from balance]")
            player.balance = player.balance - player.bet
          end if
        else
          print("Bet must be between 1 and "+player.balance+" or [q]uit.")
        end if
      end while
    end function
  
    return blackjack(deck)
  end function
 
  ///////////////////////////////////////DRUGWARS//////////////
  ////////////////////////////////////////////////////////////
  g3 = function()
      // drug wars v 0.2 by Plu70
      //
      //
      //
  
      // game time constants
      globals.TIMELIMIT = 31
      globals.GAMETIME  =  0
      globals.GOAL = "1337331"
      
      // class player
      PLAYER = {} 
      PLAYER.location=""
      PLAYER.inventory_size=100
      //PLAYER.inventory_contents=[]
      PLAYER.heat=0
      PLAYER.event_status=""
      
      //////////////// GRAPHICS /////////////////
      
      colorCyan = "<color=#00FFFF><b>"
      CT = "</b></color>"
      
      logo = ["D","R","U","G","W","A","R","S"]
      
      officerHardassSprite = "
                            _______________
                            \      __      /         __
                             \_____()_____/         /  )
                             '============`        /  /
                              #---\  /---#        /  /
                             (# @\| |/@  #)      /  /
                              \   (_)   /       /  /
                              |\ '---` /|      /  /
                      _______/ \\_____// \____/ o_|
                     /       \  /     \  /   / o_|
                    /|           o|        / o_| \
                   / |  _____     |       / /   \ \
                  /  |  |===|    o|      / /\    \ \
                 |   |   \@/      |     / /  \    \ \
                 |   |___________o|__/----)   \    \/
                 |   '              ||  --)    \     |
                 |__________________||  --)     \    /
                     |           o|   ''''   |   \__/
                     |            |          |
                       ""Officer Hardass"" Img by Rosebud"
      
      
                                              
      deaSprite = "
         Art by Joan G. Stark
                 _.---._
              .-' ((O)) '-.
               \ _.\_/._ /
                /..___..\
                ;-.___.-;
               (| e ) e |)     .;.
                \  /_   /      ||||
                _\__-__/_    (\|'-|
              /` / \V/ \ `\   \ )/
             /   \  Y  /   \  /=/
            /  |  \ | / {}  \/ /
           /  /|   `|'   |\   /
           \  \|    |.   | \_/
            \ /\    |.   |
             \_/\   |.   |
             /)_/   |    |
            // ',__.'.__,'
           //   |   |   |
          //    |   |   |
         (/     |   |   |
                |   |   |
                | _ | _ |
                |   |   |
                |   |   |
                |   |   |
          jgs   |___|___|
                /  J L  \
               (__/   \__)"
      
      
                      fbiSprite = "
                      FBI
                              _ _.-'`-._ _
                              ;.'________'.;
                  _________n.[____________].n_________
                  |''_''_''_''||==||==||==||''_''_''_'']
                  |'''''''''''||..||..||..||'''''''''''|
                  |LI LI LI LI||LI||LI||LI||LI LI LI LI|
                  |.. .. .. ..||..||..||..||.. .. .. ..|
                  |LI LI LI LI||LI||LI||LI||LI LI LI LI|
              ,,;;,;;;,;;;,;;;,;;;,;;;,;;;,;;,;;;,;;;,;;,,
              ;;jgs;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      "
      
      
      
                      elGuapoSprite = "
                      .------\ /------.
                      |       -       |
                      |               |
                      |               |
                      |               |
                   _______________________
                   ===========.===========
                     / ~~~~~     ~~~~~ \
                    /|     |     |\
                    W   ---  / \  ---   W
                    \.      |o o|      ./
                     |                 |
                     \    #########    /
                      \  ## ----- ##  /
                       \##         ##/
                        \_____v_____/"
      
      
              rabbitSprite = "
                       ____...                                  
                .-'--''''.__    `.                                
               |            `    |                                
      (         `._....------.._.:          
      )         .()''        ``().                                
      '          () .=='  `===  `-.         
      . )       (         g)                                
      )         )     /        J          
      (          |.   /      . (                                  
      $$         (.  (_'.   , )|`                                 
      ||         |\`-....--'/  ' \                                
      /||.         \\ | | | /  /   \.                              
      //||(\         \`-===-'  '     \o.                            
      .//7' |)         `. --   / (     OObaaaad888b.                 
      (<<. / |     .a888b`.__.'d\     OO888888888888a.               
      \  Y' |    .8888888aaaa88POOOOOO888888888888888.              
      \  \ |   .888888888888888888888888888888888888b              
      |   |  .d88888P88888888888888888888888b8888888.             
      b.--d .d88888P8888888888888888a:f888888|888888b             
      88888b 888888|8888888888888888888888888\8888888"
      
      
      
      downTownSprite = "
              __   __                     ___      _
             |  | |  |      /|           |   |   _/ \_
             |  | |  |  _  | |__         |   |_-/     \-_     _
           __|  | |  |_| | | |  |/\_     |   |  \     /  |___|
          |  |  | |  | | __| |  |   |_   |   |   |___|   |   |
          |  |  |^|  | ||  | |  |   | |__|   |   |   |   |   |
          |  |  |||  | ||  | |  |   | /\ |   |   |   |   |   |
          ~~~~~~~~~~~~~~~~~~~~~~~~~~~/  \~~~~~~~~~~~~~~~~~~~~~~~
         ~ ~~  ~ ~~ ~~~ ~ ~ ~~ ~~ ~~ \   \__   ~  ~  ~~~~ ~~~ ~~
       ~~ ~ ~ ~~~ ~~  ~~ ~~~~~~~~~~ ~ \   \o\  ~~ ~ ~~~~ ~ ~ ~~~
         ~ ~~~~~~~~ ~ ~ ~~ ~ ~ ~ ~ ~~~ \   \o\=   ~~ ~~  ~~ ~ ~~
      ~ ~ ~ ~~~~~~~ ~  ~~ ~~ ~ ~~ ~ ~ ~~ ~ ~ ~~ ~~~ ~ ~ ~ ~ ~~~~"
      
      
      villaSprite = "
                             X_x
                            / \\\
                            |n| |
                          )(|_|-'X
                         /  \\Y// \
                         |A | | |A|
                         |  | | |_|
                  )(__X,,|__|MEB;;;-,)(,
                 /  \\\;;;;;;;;;;;;/    \
                 |A | |            | U  |
               )_|  | |____)-----( |    |
              ///|__|-'////       \|___)=(__X
             /////////////         \///   \/ \
             |           |  U    U |//     \u|
             |   )_,-,___|_)=(     | |  U  |_|_X
             |  ///   \\|//   \    | |  __ |/// \
           )_')(//     \Y/     >---)=( /  \|  | |-----------------..,
          //// ,\ u   u |   u /////   \|  ||__|A|----------------.., \,
         |  | .. |      |    ///// ,-, \__||--------------------.., \, \,
      ---'--'_::_|______'----| u | | | |-----------------------.., \, \, \,
                             |___|_|_|_|----------------------.., \, \, \, \,
      -------------------------------------------------------.., \, \, \, \, \
                                                                        \Valkyrie"
      
      
      gcccSprite = "
                                                                |>>>
                         _                      _                |
          ____________ .' '.    _____/----/-\ .' './========\   / \
         //// ////// /V_.-._\  |.-.-.|===| _ |-----| u    u |  /___\
        // /// // ///==\ u |.  || | ||===||||| |T| |   ||   | .| u |_ _ _ _ _ _
       ///////-\////====\==|:::::::::::::::::::::::::::::::::::|u u| U U U U U
       |----/\u |--|++++|..|'''''''''''::::::::::::::''''''''''|+++|+-+-+-+-+-+
       |u u|u | |u ||||||..|              '::::::::'           |===|>=== _ _ ==
       |===|  |u|==|++++|==|              .::::::::.           | T |....| V |..
       |u u|u | |u ||HH||         \|/    .::::::::::.
       |===|_.|u|_.|+HH+|_              .::::::::::::.              _
                      __(_)___         .::::::::::::::.         ___(_)__
      ---------------/  / \  /|       .:::::;;;:::;;:::.       |\  / \  \-------
      ______________/_______/ |      .::::::;;:::::;;:::.      | \_______\________
      |       |     [===  =] /|     .:::::;;;::::::;;;:::.     |\ [==  = ]   |
      |_______|_____[ = == ]/ |    .:::::;;;:::::::;;;::::.    | \[ ===  ]___|____
           |       |[  === ] /|   .:::::;;;::::::::;;;:::::.   |\ [=  ===] |
      _____|_______|[== = =]/ |  .:::::;;;::::::::::;;;:::::.  | \[ ==  =]_|______
       |       |    [ == = ] /| .::::::;;:::::::::::;;;::::::. |\ [== == ]      |
      _|_______|____[=  == ]/ |.::::::;;:::::::::::::;;;::::::.| \[  === ]______|_
         |       |  [ === =] /.::::::;;::::::::::::::;;;:::::::.\ [===  =]   |
      ___|_______|__[ == ==]/.::::::;;;:::::::::::::::;;;:::::::.\[=  == ]___|_____"
      
      shabbyTownSprite = "
                    )
                   (      _[]_         (
           __[]___[]___[]/____\_[]_    )
          /______________|[][]|____\  (
          |[][]|[][]|[][]|[][]|[][]|__[]_
          |  /\|/\  |  /\|  /\|/\  |_____\
          |[]|||||[]|[]|||[]|||||[]|[_]|||
        ===================================
        -  -  -  -  -  -  -  -  -  -  -  -  -
      =========================================   Tom Harvey"
      
      districtSprite = "
                        \  |  /         ___________
         ____________  \ \_# /         |  ___      |       _________
        |            |  \  #/          | |   |     |      | = = = = |
        | |   |   |  |   \\#           | |`v'|     |      |         |
        |            |    \#  //       |  --- ___  |      | |  || | |
        | |   |   |  |     #_//        |     |   | |      |         |
        |            |  \\ #_/_______  |     |   | |      | |  || | |
        | |   |   |  |   \\# /_____/ \ |      ---  |      |         |
        |            |    \# |+ ++|  | |  |~~~~~~| |      | |  || | |
        |            |    \# |+ ++|  | |  |~~~~~~| |      | |  || | |
      ~~|    (~~~~~) |~~~~~#~| H  |_ |~|  | |||| | |~~~~~~|         |
        |    ( ||| ) |     # ~~~~~~    |  | |||| | |      | ||||||| |
        ~~~~~~~~~~~~~________/  /_____ |  | |||| | |      | ||||||| |
                                       ~~~~~~~~~~~~~      | ||||||| |"
      
      
      shadyAcresSprite = "
        ~         ~~          __
             _T      .,,.    ~--~ ^^
       ^^   // \                    ~
            ][O]    ^^      ,-~ ~
         /''-I_I         _II____
      __/_  /   \ ______/ ''   /'\_,__
        | II--'''' \,--:--..,_/,.-{ },
      ; '/__\,.--';|   |[] .-.| O{ _ }
      :' |  | []  -|   ''--:.;[,.'\,/
      '  |[]|,.--'' '',   ''-,.    |
        ..    ..-''    ;       ''. '  Steven Maddison"
      
      lasGreygasSprite = "
                                       .''.
             .''.             *''*    :_\/_:     . 
            :_\/_:   .    .:.*_\/_*   : /\ :  .'.:.'.
        .''.: /\ : _\(/_  ':'* /\ *  : '..'.  -=:o:=-
       :_\/_:'.:::. /)\*''*  .|.* '.\'/.'_\(/_'.':'.'
       : /\ : :::::  '*_\/_* | |  -= o =- /)\    '  *
        '..'  ':::'   * /\ * |'|  .'/.\'.  '._____
            *        __*..* |  |     :      |.   |' .---'|
             _*   .-'   '-. |  |     .--'|  ||   | _|    |
          .-'|  _.|  |    ||   '-__  |   |  |    ||      |
          |' | |.    |    ||       | |   |  |    ||      |
       ___|  '-'     '    ''      '-'   '-.'    '`      |____
      jgs~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      "
      capitolSprite = "
                                   ^
                      _______     ^^^
                     |xxxxxxx|  _^^^^^_
                     |xxxxxxx| | [][]  |
                  ______xxxxx| |[][][] |
                 |++++++|xxxx| | [][][]|      
                 |++++++|xxxx| |[][][] |
                 |++++++|_________ [][]|
                 |++++++|=|=|=|=|=| [] |
                 |++++++|=|=|=|=|=|[][]|
      ___________|++HH++|  _HHHH__|   _________   _________  _________
               _______________   ______________      ______________
      __________________  ___________    __________________    ____________"
      
      
      
      
      /////////////////////////////////////////////
      
      ////// DRUGS /////////
      drug = {}
      drug.price=0
      drug.size=0
      drug.event_status=""
      drug.availability=1
      drug.held=0
      drug.buy = function(amount)  // handles moving inventory. does not handle payment. takes player object, integer
          if typeof(amount) != "number" or amount < 1 or amount > self.availability then return 0
          if player.cash < self.cost * amount then return 0
          if self.size * amount <= player.inventory_size then self.held = self.held + amount else return 0
          player.debit( (self.cost * amount) )
          player.update_inventory( "in", (self.size * amount) )
          self.availability = self.availability - amount
          return 1
      end function 
      drug.sell = function(amount) // handles moving inventroy. does not handle payment. takes player object, integer
          if typeof(amount) != "number" or amount < 1 then return 0
          if self.held >= amount then self.held = self.held - amount else return 0
          player.credit( (self.cost * amount) )
          player.update_inventory("out", self.size * amount)
          self.availability = self.availability + amount
          return 1
      end function
      
      //
      
      cannabis = new drug
      cannabis.name = "cannabis"
      cannabis.price = 100
      cannabis.size = 4
      cannabis.cost = 100
      cannabis.icon = "<color=green><b>_\||/_</b></color>"
      
      mushrooms = new drug
      mushrooms.name = "mushrooms"
      mushrooms.price = 50
      mushrooms.size = 2
      mushrooms.cost = 50
      mushrooms.icon = "<color=white><b>.<color=red>`<color=white>||</color>`</color>.</b></color>"
      
      molly = new drug
      molly.name = "molly"
      molly.price = 20
      molly.size = 1
      molly.cost = 20
      molly.icon = "<color=orange><b>..(o).</b></color>"
      
      cocaine = new drug
      cocaine.name = "cocaine"
      cocaine.price = 500
      cocaine.size = 10
      cocaine.cost = 500
      cocaine.icon = "<color=white><b>.[==].</b></color>"
      
      heroin = new drug
      heroin.name = "heroin"
      heroin.price = 1000
      heroin.size = 20
      heroin.cost = 1000
      heroin.icon = "<color=#272626ff><b>.====.</b></color>"
      
      lean = new drug
      lean.name = "lean"
      lean.price = 300
      lean.size = 4
      lean.cost = 300
      lean.icon = "<color=purple><b>.<u>|~~|</u>.</b></color>"
      
      crack = new drug
      crack.name = "crack"
      crack.price = 200
      crack.size = 5
      crack.cost = 200
      crack.icon = "<b><color=white>.<*<*></b></color>"
      
      acid = new drug
      acid.name = "acid"
      acid.price = 400
      acid.size = 3
      acid.cost = 400
      acid.icon = "<b><color=blue>.{#}..</b></color>"
      _drogas = [cannabis,mushrooms,molly,cocaine,heroin,lean,crack,acid]
      
      //////// END DRUGS /////////
      
      //////// NEIGHBORHOODS /////////
      
      neighborhood = {}
      neighborhood.name=""
      neighborhood.wealth=""
      neighborhood.population=""
      neighborhood.drug_modifiers=""
      neighborhood.event_status=""
      
      downtown = new neighborhood
      downtown.name = "Downtown"
      downtown.wealth = 10000
      downtown.population = 1000
      downtown.drug_modifiers =    {"cannabis":"medium","mushrooms":"medium","molly":"medium","cocaine":"high","heroin":"high","lean":"medium","crack":"medium","acid":"medium"}
      downtown.sprite = downTownSprite
      
      villa = new neighborhood
      villa.name = "Greyton's Villa"
      villa.wealth = 50000
      villa.population = 100
      villa.drug_modifiers =      {"cannabis":"low","mushrooms":"low","molly":"low","cocaine":"high","heroin":"high","lean":"medium","crack":"low","acid":"medium"}
      villa.sprite = villaSprite
      
      gccc = new neighborhood
      gccc.name = "Grey County Community College"
      gccc.wealth = 5000
      gccc.population = 3000
      gccc.drug_modifiers =       {"cannabis":"high","mushrooms":"high","molly":"medium","cocaine":"medium","heroin":"medium","lean":"medium","crack":"medium","acid":"low"}
      gccc.sprite = gcccSprite
      
      shabbytown = new neighborhood
      shabbytown.name = "Shabbytown"
      shabbytown.wealth = 2000
      shabbytown.population = 1000
      shabbytown.drug_modifiers = {"cannabis":"medium","mushrooms":"medium","molly":"medium","cocaine":"low","heroin":"medium","lean":"high","crack":"high","acid":"medium"}
      shabbytown.sprite = shabbyTownSprite
      
      district = new neighborhood
      district.name = "District 108"
      district.wealth = 3500
      district.population = 500
      district.drug_modifiers =  {"cannabis":"low","mushrooms":"medium","molly":"low","cocaine":"medium","heroin":"high","lean":"high","crack":"high","acid":"medium"}
      district.sprite = districtSprite
      
      shady = new neighborhood
      shady.name = "Shady Acres"
      shady.wealth = 8000
      shady.population = 750
      shady.drug_modifiers =    {"cannabis":"high","mushrooms":"low","molly":"high","cocaine":"medium","heroin":"low","lean":"medium","crack":"medium","acid":"medium"}
      shady.sprite = shadyAcresSprite
      
      greygas = new neighborhood
      greygas.name = "Las Greygas"
      greygas.wealth = 10000
      greygas.population = 3000
      greygas.drug_modifiers =  {"cannabis":"low","mushrooms":"high","molly":"high","cocaine":"high","heroin":"low","lean":"low","crack":"medium","acid":"high"}
      greygas.sprite = lasGreygasSprite
      
      capitol = new neighborhood
      capitol.name = "Capitol Heights"
      capitol.wealth = 10000
      capitol.population = 1500
      capitol.drug_modifiers =  {"cannabis":"medium","mushrooms":"medium","molly":"medium","cocaine":"high","heroin":"medium","lean":"low","crack":"medium","acid":"low"}
      capitol.sprite = capitolSprite
      
      _hoods = [ downtown, villa, gccc, shabbytown, district, shady, greygas, capitol ]
      if DEBUG then
          for h in _hoods
              print h.name // debug
          end for
      end if
      /////// END NEIGHBORHOODS ///////
      
      /////// EVENTS ///////////////
      event = {}
      event.names=["Officer_Hardass","The_DEA","The_FBI","El_Guapo","Rabbit"]
      //event.affects = ["player", "drug", "neighborhood"]
      //event.effect = ["price", "availability", "heat","shop"]
      event.Rabbit = function()
          print
          print rabbitSprite
          print
          print "A shadow fellow pulls you into an alley and offers you a deal."
          print "<color=yellow>Wanna buy a trenchcoat for an extra 20 inventory? $1000 cash, bub."
          print
          choice = user_input("[1] or Yes (anything else for no):> ")
          if choice == "1" or choice.lower == "yes" then 
              if player.cash >= 1000 then 
                  print
                  print "<color=yellow>Here you go. Hmm, looks good on you."
                  player.cash = player.cash - 1000
                  player.inventory_size = player.inventory_size + 20
                  player.event_status = "none"
              else 
                  print
                  print "<color=yellow>You don't have the cash, bub!"
              end if
          else 
              print
              print "<color=yellow>A'ight, cool. I know someone else that wants it."
          end if
          return null
      end function 
      event.El_Guapo = function()
          print 
          print elGuapoSprite
          print
          print "El Guapo's narco sub has made berth. "
          print "The market has been flooded with cheap drugs!"
          print "Deals like these won't last long!"
          player.event_status = "none"
          return user_input("press <<b>enter</b>> to continue"+char(10))
      end function 
      event.The_FBI = function()
          print 
          print fbiSprite
          print
          print "The FBI opened an investigation into you! "
          print "They are demanding $"+ceil(player.cash / 10)+" in bribes to avoid jail time!"
          print "You fill a duffel bag with the money and head to the FBI field office."
          print "When you arrive you dump the cash on their doorstep."
          print "You decide to keep the duffelbag. "
          print "Your inventory space has increased by 10!"
          player.cash = ceil(player.cash / 10)
          player.inventory_size = player.inventory_size + 10
          player.event_status = "none"
          return user_input("press <<b>enter</b>> to continue"+char(10))
      end function 
      event.The_DEA = function()
          print 
          print deaSprite
          print
          print "The DEA made a major bust! \nDrug availability has temporarily gone down! \nPrices have permanently gone up!"
          player.event_status = "none"
      
          return user_input("press <<b>enter</b>> to continue"+char(10))
      end function 
      event.Officer_Hardass = function()
      
          print 
          print officerHardassSprite
          print
          print "Officer Hardass caught you slinging dope and beat your ass! "+char(10)+"He took all your drugs and you had to bribe him with $"+ceil(player.cash / 10)+" to avoid jail time."
          print "Barely able to stand, you wonder if you will survive another day."
          player.cash = player.cash - ceil(player.cash / 10)
          for d in _drogas 
              a = d.held
              d.sell(a)
              player.debit(d.cost * a)
          end for
          player.event_status = "none"
          return user_input("press <<b>enter</b>> to continue"+char(10))
      end function 
      ////// END EVENTS //////////
      
      // win condition
      _score = function()
          if player.cash >= GOAL.to_int then return("You win! :]") else return("You lose. :[")
          return null
      end function
      
      // each time the player moves we tick the clock up one.
      _game_time_update = function()
          globals.GAMETIME = GAMETIME + 1
          status = null
          if GAMETIME >= TIMELIMIT then status = (_score)
          if DEBUG then print "debug: tick"
          if DEBUG then print "debug: gametime: "+GAMETIME
          player.event_status = "none"
          if event.names.len > 0 then
              ev = range(0,9)
              ev.shuffle 
              e = ev.pop 
              event.names.shuffle   
              if DEBUG then 
                  player.event_status = event.names.pop 
              else 
                  if e > 7 then player.event_status = event.names.pop // 20% chance
              end if
              if player.event_status == "Rabbit" then event.names.push("Rabbit") // make sure there's always a chance to up capacity
          end if 
          return status
      end function 
      
      // drug price and availability based on popularity and population
      _update_drug_prices = function(locale)
          price = {}
          price.low = [1,1.5,2,2.5,3]
          price.medium = [3.5,4,5,6,4]
          price.high = [6.5,7,8,9,2]
      
          for d in _drogas 
              // modify prices
              r = [0,1,2,3,4]
              r.shuffle 
              if DEBUG then print "debug: "+d.name+char(10)+"debug: "+locale.name
              mod = price[locale.drug_modifiers[d.name]][r[0]]
              d.cost = d.price * mod
              d.availability = ceil(locale.population / mod)
              if player.event_status == "El_Guapo" then 
                  d.availability = d.availability * 2
                  d.cost = ceil(d.cost / 1.5)
              end if
              if player.event_status == "The_DEA" then 
                  d.price = d.price + (d.price / 10)
                  d.availability = ceil(d.availability / 2)
                  d.cost = ceil(d.cost * 1.5)
              end if 
              if DEBUG then print "debug: cost: "+ d.cost
              if DEBUG then print "debug: avail: "+ d.availability
          end for 
      end function
      
      ///////////////////////////////////////
      //////// PLAYER ONE /////////
      
      player = new PLAYER 
      player.location = downtown // player starts here
      player.inventory_size=100
      //player.inventory_contents=[]
      player.heat=0
      player.event_status="none"
      player.cash = 100
      //
      player.update_location = function(moveto) // expects neighborhood object
          if DEBUG then print "debug: moveto: "+moveto.name // debug
          if self.location != moveto then self.location = moveto else return 0
          stat = _game_time_update
          _update_drug_prices(self.location)
          if player.event_status != "none" then event[player.event_status]
          return 1
      end function
      //
      player.debit = function( amount )
          if typeof(amount) != "number" or amount > player.cash or amount < 1 then return 0
          self.cash = self.cash - amount 
          return 1
      end function 
      player.credit = function( amount )
          if typeof(amount) != "number" or amount < 1 then return 0
          self.cash = self.cash + amount 
          return 1
      end function
      //
      player.update_inventory = function( direction, amount )
          if direction == "in" then self.inventory_size = self.inventory_size - amount
          if direction == "out" then self.inventory_size = self.inventory_size + amount 
          return null
      end function
      //player.property = ["none"]
      //player.net worth = 100
      //////////////////////////////////////
      
      move_menu = function(pr)
          print "current location: "+pr.location.name
          for h in _hoods
              //print h
              print "[<b>"+_hoods.indexOf(h)+"</b>] - "+h.name
          end for 
          choice = user_input("Move to :> ").to_int// int
          if choice == "" then return pr.location
          if DEBUG then print "debug: choice: "+choice
          if typeof(choice) == "number" and choice >= 0 and choice < _hoods.len then return _hoods[choice] else return pr.location // if we didn't move, return current location
      end function 
      
      drug_menu = function()
          print // something
          buf = []
          for d in _drogas
              buf.push("[<b>"+_drogas.indexOf(d)+"</b>] - "+d.name+" $"+d.cost+" "+d.availability+" units available, "+d.held+"/"+ ( floor( player.inventory_size / d.size ) + d.held ) + " units held "+d.icon )
          end for 
          print format_columns(buf.join(char(10)))
          choice = user_input(":> ")
          if choice == "" then return 
          if typeof(choice.to_int) == "number" and choice.to_int >= 0 and choice.to_int < _drogas.len and _drogas.hasIndex(choice.to_int) then return _drogas[choice.to_int] else print "Invalid selection."
          return 0
      end function 
      
      
      playing = true
      
      // game loop
      while playing == true
          if not DEBUG then print(" ",1)
          print    
          print player.location.sprite
          print
          // show location
          print "<u><color=#40865bff>Location: <b>"+player.location.name+"</b></u> <u>Days Left: <b>"+ (31 - GAMETIME)
          // show inventory
          print "<u><color=#40865bff>Inventory: <b>"+player.inventory_size+"</b> pocket space available."
          d_b = []
          print "- - - - - - - - - - - - - - - - - - - -"
          for d in _drogas
              d_b.push(  "<u><color=#40865bff>"+d.name.upper+" |"+colorCyan+d.held+CT+"|</u> <color=red>"+logo.pull+"</color> ["+d.icon+"]" )
          end for
          print format_columns(d_b.join(char(10)))
      
          // show cash
          print 
          print "<color=#40865bff>Cash: <color=yellow><b>$"+player.cash+"</color> Goal: >= <color=yellow>"+GOAL
          print
      
          // show prompt
          if player.event_status != "none" then print "[<color=yellow>E</color>] - "+player.event_status
          print "[<color=white>1</color>] - Buy [<color=white>2</color>] - Sell [<color=white>3</color>] - Move [<color=white>q</color>] - quit"
      
          // handle choices
          choice = user_input(":> ")
      
          // quit
          if choice == "q" then return "goodbye"
      
          // handle [rabbit] event
          if choice.lower == "e" and player.event_status != "none" then 
              event[player.event_status]
              user_input("press <<b>enter</b>> to continue")
              continue
          end if
      
          // -- buy drugs
          if choice == "1" then 
              drug_to_buy = drug_menu
              if drug_to_buy then print "Buying "+drug_to_buy.name else continue
              if drug_to_buy.buy(user_input("Amount :> ").to_int) then print "Success." else print "Failed."
              user_input("press <<b>enter</b>> to continue")
              continue
          end if
      
          // -- sell drugs
          if choice == "2" then 
              drug_to_sell = drug_menu
              if drug_to_sell then print "Selling "+drug_to_sell.name else continue
              if drug_to_sell.sell(user_input("Amount :> ").to_int) then print "Success." else print "Failed."
              user_input("press <<b>enter</b>> to continue")
              continue
          end if
      
          // -- move location // update prices, availability and location
          if choice == "3" then
              move = player.update_location(move_menu(player))
              if move == 1 then print "Travelling..." 
              if move == 0 then print "Staying put."
              if typeof(move) == "string" then return move // game over win/lose
              user_input("press <<b>enter</b>> to continue")
              continue
          end if
      
          // repeat until timelimit
          // exit with score
      end while
  end function
